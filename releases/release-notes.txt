===================================================================
                     MMBase 1.7.0 - Release Notes
===================================================================

============
INTRODUCTION:
============

This document describes the changes that have been made in the final
release of MMBase 1.7.0, relative to the previous release of MMBase (1.6).

Bug reports should be entered at the bug reporting system for MMBase
at:

<http://www.mmbase.org/bug>


============
NEW FEATURES:
============

--------------------
General New Features:
--------------------

- Query-object, which allows for several new taglib and MMCI features.

- New storage layer, which allows for real transactions!

- Some 'applications' (like editwizards) have been split up to seperate jars. This will allow for
  easiers partial upgrades of installations.

- Added functionality to the jsp editors: better paging mechanism.

- Added functionality to the jsp admin pages: add/change field descriptions

--------------------------
MMCI (bridge) New Features:
-------------------------
[1.7.0]

- All interfaces of the new org.mmbase.storage.search package are part of the 'bridge' now.  There
  is also a new 'Query' object in org.mmbase.bridge, which allows for query creation and
  modification in a generic way.

- The new Query frame work allows for easy execution of 'aggregating queries' (e.g. counts) through the
  bridge.

- The bridge implementation now also lets security modify its queries to exclude read-protected
  nodes. Depending on the security implementation and configuration this should speed up things.

- Several small additions (like Cloud.getRelationManager(NodeManager, NodeManager, String));

-------------------
Taglib New Features:
-------------------

[1.7.0]

- Content-Tag, which provides default escaping behaviour, postprocessing functionality, and
  content-type information.

- Container tags.

  - Function Container tag. Allows for more complicated arguments to functions on e.g. Nodes.

  - List Container Tags. Allow for easier generic queries (using new Query frame work). The Query
    object can be changed with a 'constraint' tag, an 'ageconstraint' tag, a maxnumber tag and an
    'offset' tag. The query can be executed by the already existing nodelist tags. Also the size
    tag, can optionally be used outside a list tag now (but inside a list container tag), and will
    then be calculated by the database (and not progamaticly).

- 'previousbatches' and 'nextbatches' tags. A way to easily make a paging mechanism for big search
  results.

- unrelatednodes tag. A tag to list all nodes (of a certain type) which are _not_ related to a node.

- compare tag: valueSet attribute

- List-tags now provide a kind of 'temporary' context for taglib variables. In practice this means
  that inner context tags (or 'remove' tags) will not be needed any more.

...


==========================
BUG FIXES AND IMPROVEMENTS:
==========================

-------------------
Generic Improvement:
-------------------

[1.7.0]
- Several tags in builder xmls are no longer mandatory, and sensible defaults will be used instead
  (for example in the editor section)
- jspsmartupload has been replaced with jakarta's commons FileUpload component.

------------------
Generic Bug Fixes:
------------------
[1.7.0]
- jaxp compliance. MMBase does not longer depend on an old version of xerces/xalan/xml-apis
  when running under java 1.4 you can remove those files

- Logging: The mmbase logger now uses a wrapper so that at startup it first caches the messages until the
  logger is initialized

- added java14patch target to patch mmbase to be able to compile under java 1.4

- caching of Query results is done better. It is possible to cache everything. In 1.6 some queries
  accidentely where not cached. This fix is based on the new Query framework.

- when exporting builder xmls, the state propery of a field is now in lowercase (as defined by the
  dtd)

- More robust in case Database not up yet if MMBase starts, or if database restart when MMBase
  remains up.

------------------
Security Bug Fixes:
------------------
[1.7.0]
- It is for a security implementation possible to define new ranks now.

- Queries are checked by all 'official' security implementations. If there are read-restrictions on
  defined on your installation, you need to create an index on the owner fields.


-----------------
Taglib Bug Fixes:
-----------------
[1.7.0]
 - Working with resin now

 - Lots of small attributes-related things, like emulating complete absence of the the attribute
   when its value is empty. Some attributes (like the 'id' attribute) did not yet accept taglib
   variables ($-variables), which also has been fixed on several places.

 - URL-tag not a Writer any more.



-----------------
Example Bug Fixes:
-----------------
[1.7.0]

========
Upgrade:
========
[1.7.0]
- Replace mmbase.jar with the new jars.
  - if you used editwizards, place mmbase-editwizard.jar (from mmbase-editwizard.zip)

  - if you used community, place mmbase-community.jar (from mmbase-community.zip)
    You can remove mmcommunity-taglib.tld too and place this in web.xml in stead:
    <taglib>
      <taglib-uri>http://www.mmbase.org/mmcommunity-taglib-1.0</taglib-uri>
      <taglib-location>/WEB-INF/lib/mmbase-community.jar</taglib-location>
    </taglib>

-  Replace all shipped jsps too (e.g. mmeditors, mmexamples, mmadmin)
   - The editwizard jsp and xsls are in mmbase-editwizard.zip now.

- remove WEB-INF/mmbase-taglib.tld and write in web.xml in stead:
  <taglib>
    <taglib-uri>http://www.mmbase.org/mmbase-taglib-1.0</taglib-uri>
    <taglib-location>/WEB-INF/lib/mmbase.jar</taglib-location>
  </taglib>

- Clean the working directory of your app-server (to recompile jsp's)


========================
Know Issues and Problems:
========================

- Orion doesn't support the final servlet api 2.3, because of this the
  jumpersFilter will not work. You will need to remove the following
  lines from <WEB-INF/web.xml>:

    <!-- Filter for jumpers -->
    <filter>
      <filter-name>Jumpers Filter</filter-name>
      <display-name>Jumpers Filter</display-name>
      <description>Filter used for jumpers</description>
      <filter-class>org.mmbase.servlet.JumpersFilter</filter-class>
    </filter>

    <filter-mapping>
      <filter-name>Jumpers Filter</filter-name>
      <url-pattern>/*</url-pattern>
    </filter-mapping>

  And replace them with:

    <servlet>
      <servlet-name>servjumpers</servlet-name>
      <display-name>servjumpers</display-name>
      <servlet-class>org.mmbase.servlet.servjumpers</servlet-class>
    </servlet>

    <servlet-filter url-pattern="/*" servlet-name="servjumpers" />

  (I'm not sure where the last line has to be: web.xml or orion-web.xml).


- Length of email field inside Users and People builder isn't
  rfc-complient, but with 255 it stays beyond a limit some databases
  use before switching to a bigger string-type (eg clob).

- Not all HTML is html4 or xhtml valid

- Sometimes it is needed to copy xml-apis.jar to
  <$CATALINA_HOME/common/lib/> or $ORION_HOME, eg if you're doing xslt-transformation
  or if you're using the editwizards.

- Imagemagick does work with Windows 98/ME, but MMBase is not able to
  use it. You have to use Jai (Java Advanced Imaging API). You can do
  this by changing the properties in

   <mmbase-webapp>/WEB-INF/config/builders/applications/images.xml (after installation of 'Resource')
   or
   <mmbase-webapp>/WEB-INF/config/applications/Resources/builders/images.xml (before installation of 'Resource')

   into:

  <properties>
    <property name="ImageConvertClass">
      org.mmbase.module.builders.ConvertJAI
    </property>
    <property name="MaxConcurrentRequests">20</property>
  </properties>

  Please keep in mind that the image builder is less powerfull when
  using JAI instead of Imagemagick.

- Jumpers jump to /index.html by default, which can e.g. shield the
  image servlet (if 'dotlessly' mapped). Remove the setting from
  jumpers.xml if you prefer nice 404's (this is like this on default)

- Hsqldb uses the current dir for writing the database-files. This can
  be the bin dir from where you're starting the servlet-engine. You
  can change this to a dir you want, by changing the database-property
  in jdbc.xml.

- Resin provides its own XSL-transformation implementation, on this
  area are some known problems.

- Resin cannot swallow some of the larger jsp/taglib pages.


============
Requirements:
============

MMBase needs an servlet engine which supports the servlet api 2.3 and
jsp api 1.2. Furthermore it needs a database and a jdbc-driver.

The 'bin' distro does include a hsql database and driver.


=========
Tested on:
=========

The applications listed here are known to be tested with MMBase, but
the list is probably a lot bigger :-)

-------------
Java versions
-------------
- J2SE 1.4.2

-------------
Java compilers
-------------

- sun jdk 1.4.2 (javac)

- jikes version 1.18

  using 1.15 jsp-editwizards don't work (when using jikes for jsp-compilation)
  using 1.16 mmbase does compile, but give VerifyExceptions on running. See:
  http://www-124.ibm.com/developerworks/bugs/?func=detailbug&bug_id=206&group_id=10

------------------
Servlet engines /
Applicationservers
------------------
- Tomcat 4.0.4
- Orion 1.5.2, 1.5.4
- Jetty 4.0.0
- Resin 2.1.0, 2.1.8
- Tomcat 4.1.12, 4.1.21
- Tomcat 5.0.16

---------
Databases
---------
- Hsqldb 1.7.0RC2
- Mysql Ver 11.12 Distrib 3.23.32,
        Ver 11.16 Distrib 3.23.49,
        Ver 11.15 Distrib 3.23.41
  for pc-linux-gnu (i686)
- Postgresql



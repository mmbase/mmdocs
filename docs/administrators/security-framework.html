<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>The MMBase Security Framework</title><link href="../style/documentation.css" rel="stylesheet" type="text/css" /><meta content="DocBook XSL Stylesheets V1.72.0" name="generator" /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="icon" /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="shortcut icon" /><meta xmlns="" content="text/html; charset=utf-8" http-equiv="content-type" /></head><body><div xmlns="" class="navigation"><img alt="mmbase logo" src="../style/logo.png" /><h2>The MMBase Security Framework</h2><p><a href="security-framework.html#introduction">Introduction</a></p><p><a href="security-framework.html#securityframework">The MMBase Security Framework</a></p><p><a href="security-framework.html#configuration">Configuring the Security Framework</a></p><p><a href="security-framework.html#usage">Using the Security Framework</a></p><p><a href="security-framework.html#implementation">Implementing Your Own Security System</a></p><hr /><p><a href="http://www.mmbase.org">MMBase</a></p><p><a href="../index.html">home</a></p></div><div class="article" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="N10001" />The MMBase Security Framework</h1></div><div><div class="authorgroup"><strong class="authorgroup">Authors: </strong><span class="author"><span class="firstname">Eduard</span> <span class="surname">Witteveen</span>, </span><span class="author"><span class="firstname">Sjoerd</span> <span class="surname">de Heer</span>, </span><span class="author"><span class="firstname">Henk</span> <span class="surname">Hangyi</span>, </span><span class="author"><span class="firstname">Pierre</span> <span class="surname">van Rooden</span>, </span><span class="author"><span class="firstname">Michiel</span> <span class="surname">Meeuwissen</span></span><br /><strong class="authorgroup">Date: </strong>2003-02-12</div></div><div><div class="legalnotice"><a id="N10029" /><p>This software is OSI Certified Open Source Software. OSI Certified is a certification mark of the Open Source Initiative.</p><p>The license (Mozilla version 1.0) can be read at the MMBase site. See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/license" target="_top">http://www.mmbase.org/license</a>
      </p></div></div><div /></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="security-framework.html#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="security-framework.html#requirements">1.1. Requirements</a></span></dt></dl></dd><dt><span class="section"><a href="security-framework.html#securityframework">2. The MMBase Security Framework</a></span></dt><dd><dl><dt><span class="section"><a href="security-framework.html#overview">2.1. Overview of the MMBase Architecture</a></span></dt><dt><span class="section"><a href="security-framework.html#modules">2.2. Authentication and Authentication Modules</a></span></dt><dt><span class="section"><a href="security-framework.html#authorization">2.3. Authorization</a></span></dt><dt><span class="section"><a href="security-framework.html#authentication">2.4. User Information</a></span></dt></dl></dd><dt><span class="section"><a href="security-framework.html#configuration">3. Configuring the Security Framework</a></span></dt><dd><dl><dt><span class="section"><a href="security-framework.html#general">3.1. General</a></span></dt></dl></dd><dt><span class="section"><a href="security-framework.html#usage">4. Using the Security Framework</a></span></dt><dd><dl><dt><span class="section"><a href="security-framework.html#usageauthentication">4.1. Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="security-framework.html#classauthenticionwrapper">4.1.1. Class Authentication as a Wrapper</a></span></dt></dl></dd><dt><span class="section"><a href="security-framework.html#usageauthorization">4.2. Authorization</a></span></dt></dl></dd><dt><span class="section"><a href="security-framework.html#implementation">5. Implementing Your Own Security System</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="introduction" />1. Introduction</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="requirements" />1.1. Requirements</h3></div></div></div><p>
        MMBase uses a security framework in which different security implementations can be
        used. This means that it is possible to developer various types of security systems, adapting MMBase
        to the needs of the environment in which it runs. A number of default implementations are available
        in MMBase (such as the context security, documented elsewhere), but new ones can be developed and
        easily substituted using the security configuration files.
      </p><p>
        This document focuses on the security framework. It falls in four parts.
      </p><p>
        The first part explains the general architecture, and the way security is used by MMBase. It
        explains what is possible in the approach we use and what isn't. It also comments on where security
        is used, and how it can be circumvented.
      </p><p>
        The second part explains how to configure the security framework, such as when you want to
        install an alternate security system.
      </p><p>
        The third part explains how to transparently use the security in scripts (the MMCI) or with
        the MMBase taglib.
      </p><p>
        The final part is a few handouts on how to build your own security system.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="securityframework" />2. The MMBase Security Framework</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="overview" />2.1. Overview of the MMBase Architecture</h3></div></div></div><div><img src="media/architecture.png" /></div><p>
        As the MMBase architecture image shows, the MMBase security framework forms a layer between
        the MMBase core and the MMCI - the MMBase Cloud Interface which is used for external programs and
        applications to communicate with the system.
      </p><p>
        All communication through the MMCI uses the security layer, while the 'core classes' of the
        system generally don't. This allows the core to handle requests quickly, while maintaining security
        where it matters - in communication with external sources.
      </p><p>
        When a user connects to MMBase using an external application (such as the taglibs, a jsp
        servlet, or the editwizards), that application creates a session to maintain the state of the
        user. In other words: maintaining state is left to the external application. Security itself does
        not offer this functionality as it is dependent on the means of communication.
      </p><p>
        The application then authenticates the user through a call to the bridge, passing
        authentication parameters appropriate to the authentication module in use. Various authentication
        modules may exist - each offering a different way of authentication, and possibly a different
        measure of reliability or accountability.
      </p><p>
        Once authenticated, the security passes a User object back, which contains the information
        required by the Authorization module. The bridge encapsulates the user object in the Cloud object,
        which is passed to the calling application. The application should then take care of storing the
        cloud in a session.
      </p><p>
        The user object is passed to the security system every time the bridge performs a
        security-sensitive operation. This is done automatically - a calling application need not perform
        any additional actions. Operations are defined on the MMBase node-level. Any operation on a
        Node is security-sensitive: each time a node is read, created, written, deleted, or related to, the
        bridge checks whether the operation is allowed. Depending on context, the bridge then either causes
        an error or ignores the operation (for instance, when retrieving a list of nodes, the bridge will
        only return nodes the user may read, ignoring any nodes the user has no access to).
      </p><p>
        Whether rights are really defined on node level is dependent on the system. Complex security
        systems may actually specify rights for individual users on individual nodes. Other systems may use
        a more general approach, i.e. allow all actions to logged on users of a certain rank, while allowing
        only read access to others.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="modules" />2.2. Authentication and Authentication Modules</h3></div></div></div><p>
        There are various ways to authenticate a user. Name/password login is one of the most
        common, but other authentication methods might include certification, IP-filtering, or public
        keys. Another form of authentication is 'anonymous' access - which allows people to be identified as
        anonymous users. Advanced systems might use fingerprints or iris scans.
      </p><p>
        The security framework takes this into account by introducing the concept of authentication
        modules. Each module in a security implementation offers another way to authenticate a user.
      </p><p>
        There is currently no specific way to configure modules - the Authentication class deals
        with this, either by hardcoding the expected modules, or by using a configuration file specified
        with the <code class="sgmltag-attribute">url</code> attribute (such as in the context security
        system). Future versions of the security framework may include specifics on how to configure
        authentication modules.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          Authentication systems and authorization systems are originally designed as separate
          entities. Authentication systems produce User objects, where Authorization systems use these
          objects. This would theoretically mean that authentication modules can be used with different
          authorization systems.
        </p><p>
          Most security systems however use their own implementation of the User object - often so
          specific information can be retrieved by the authorization system. As such, in practice, in most
          security systems authorization classed depend on the authentication models that come with that
          system.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="authorization" />2.3. Authorization</h3></div></div></div><p>
        Authorization takes place on object level: for each object, the authorization system
        determines the rights for a specified user. How these rights are determined is not specified - a
        system can actually maintain (and store) rights per user/object, but it is also possible to determine
        access per object type, or (as is the case with the context security system), by granting user
        groups access to object groups (generally objects with the same 'context' or 'owner').
      </p><p>Forthcoming...</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="authentication" />2.4. User Information</h3></div></div></div><p>Forthcoming...</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="configuration" />3. Configuring the Security Framework</h2></div></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>
        When you alter one of the security configuration files, the security system reloads itself
        within one minute. If there are errors in the configuration, an error message is issued, and the old
        configuration will be kept active.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="general" />3.1. General</h3></div></div></div><p>
        The security framework makes it possible to use different implementations for security
        within MMBase. The implementation is specified in the security configuration file. This file is
        called <code class="filename">security.xml</code> and can be found in the <code class="filename">security</code>
        subdirectory in the MMBase configuration directory.
      </p><p>The content of the configuration file should be similar to the following:</p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE security PUBLIC "//MMBase - security//" "http://www.mmbase.org/dtd/security.dtd"&gt;
&lt;security active="true"&gt;
  &lt;authentication
    class="org.mmbase.security.implementation.context.ContextAuthentication"
    url="context/config.xml" /&gt;
  &lt;authorization
    class="org.mmbase.security.implementation.context.ContextAuthorization"
    url="context/config.xml" /&gt;
  &lt;sharedsecret&gt;my_secret_access_code&lt;/sharedsecret&gt;
&lt;/security&gt;
      </pre><p>Within this document you can alter the following:</p><div class="itemizedlist"><ul type="disc"><li><p><b>&lt;security active="..."&gt;. </b>
              The <code class="sgmltag-attribute">active</code> attribute of the security tag determines whether security is active or not.
              Valid values are 'true' and 'false'. If the value is set to
              'true' the security system (authentication and authorization classes) will be loaded and
              activated as described in the rest of the configuration. If the value is 'false' no security
              implementation well be loaded. In this case, the security configuration file will not be checked for
              changes (so no reloads will occur if the configuration is changed).
            </p><p>In the example above, the security is turned on.</p></li><li><p><b>&lt;authentication class="..." url="..." /&gt;. </b>This tag defines what class to use for executing authentication requests.</p><p>
            The <code class="sgmltag-attribute">class</code> attribute defines the path of the java
            class that should be used. The class follows a certain interface, so various implementations can be
            accessed in a similar way. If you use an alternate security system., you specify the classname
            here. If you want to turn off authentication, you can set the attribute to
            <code class="classname">org.mmbase.security.NoAuthentication</code>.
          </p><p>
            The <code class="sgmltag-attribute">url</code> attribute (which is optional) specifies the
            path to a configuration file, which is passed to the Authentication class. The path is relative to
            the <code class="filename">security.xml</code> configuration file.
          </p><p>
            In the example above, the class used for authentication is
            <code class="classname">org.mmbase.security.implementation.context.ContextAuthentication</code> (which is
            the classname of the MMBase context security authentication class). The url of the configuration
            file is <code class="filename">context/config.xml</code>, which defines (for the purpose of authentication)
            users and their passwords.
          </p></li><li><p><b>&lt;authorization class="..." url="..." /&gt;. </b>This tag defines what class to use for executing authentication requests.</p><p>
            The <code class="sgmltag-attribute">class</code> attribute defines the path of the java
            class that should be used. The class follows a certain interface, so various implementations can be
            accessed in a similar way. If you use an alternate security system, you specify the classname
            here. If you want to turn off authentication, you can set the attribute to
            <code class="classname">org.mmbase.security.NoAuthorization</code>.
          </p><p>
            The <code class="sgmltag-attribute">url</code> attribute (which is optional) specifies the
            path to a configuration file, which is passed to the Authentication class. The path is relative to
            the <code class="filename">security.xml</code> configuration file.
          </p><p>
            In the example above, the class used for authentication is
            <code class="classname">org.mmbase.security.implementation.context.ContextAuthorization</code> (which is the
            classname of the MMBase context security authorization class). The url of the configuration file is
            <code class="filename">context/config.xml</code>, which defines (for the purpose of authorization) the rights
            of users and user groups
          </p></li><li><p><b>&lt;sharedsecret&gt;...&lt;/sharedsecret&gt;. </b>
              It is possible to run more than one MMBase on the same database. The <code class="sgmltag-starttag">&lt;sharedsecret&gt;</code> tag contains a password which is used to authenticate
              servers when they attempt to communicate with each other.
            </p><p>
            In the above example, the shared secret is 'my_secret_access_code'. Other MMBase
            installations which have the same shared secret can communicate with this system.
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
              MM: AFAIK, this 'sharedsecret' feature is not implemented. I wonder why it is
              documented and obligatory in the configuration.
            </p></div></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="usage" />4. Using the Security Framework</h2></div></div></div><p>
      The two aspects of security authentication and authorization are important again when you are
      using an MMBase installation with a certain security implemenation. We will assume that you
      use the MMBase bridge interfaces or something which is based on that (e.g. the mmbase taglib)
      (when using 'core' security is not relevant at all).
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="usageauthentication" />4.1. Authentication</h3></div></div></div><p>
        The first worry is that you have to authenticate yourself. You can do this when you <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/api/org/mmbase/bridge/CloudContext.html#getCloud(java.lang.String,%20java.lang.String,%20java.util.Map)" target="_top">obtain
        the cloud object from the 'CloudContext' object.</a>.      
      </p><p>
        You will have to specify a 'cloud name' which is alway 'mmbase' in current mmbase
        implementations. Then you need to give a second string 'authentication type' which corresponds
        to the authentication modules. And the last and most important argument is a map of
        credentials. The credentials which need to be given are dependent on the chosen implementation and
        module of it.
      </p><p>
        The MMBase taglib entrance to this method is the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/docs/reference/taglib/cloud.jsp" target="_top">mm:cloud tag</a>. The
        'autentication type' or 'module' string is present here as the 'authentication' attribute. The
        other attribute of importance is the 'method' attribute, which tells the cloud tag something
        about how the map of credentials must be filled. Most 'methods' produce name/password
        combinations. The important exceptions are method="anonymous", which produces a cloud without
        using credentials (the 'anonymous' cloud), and you will normally have very limited rights, and
        method="delegate" which make the tag put the request and response objects in the credential
        map, which then can be used for further acquisition of credentials (like redirecting to an
        external authentication server).
      </p><p>
        A new 'authentication module' in MMBase 1.8 (and available for 1.7 as a 'wrapper'), is the
        'class' module , which is supported by most authentication implementations. Using this method
        of authentication you don't need to supply any credentials, because you are authenticated
        using the java strack-trace. The cloud which you obtain is then determined by an extra
        configuration file &lt;config dir&gt;classsecurity.xml, which connects classes to users.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="classauthenticionwrapper" />4.1.1. Class Authentication as a Wrapper</h4></div></div></div><p>
          The use of 'classauthentication.xml' depends on the security implementation which reads it. 
        </p><p>
          There is a special authenticion implementation available which can 'wrap' another authentication implementation. If in security.xml you specify
        </p><pre class="programlisting">
        &lt;authentication class="org.mmbase.security.classsecurity.ClassAuthenticationWrapper" url="wrapper.xml" /&gt;
        </pre><p>
          then, you wrap another implementation (which is configured in wrapper.xml). In this wrapper
          configuration you can then classes with a map of credentatials (which must be strings then).
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="usageauthorization" />4.2. Authorization</h3></div></div></div><p>
        When using the bridge, you don't have to do much...
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="implementation" />5. Implementing Your Own Security System</h2></div></div></div><p>Forthcoming...</p></div></div><hr xmlns="" /><p xmlns="">
      This is part of the <a href="http://www.mmbase.org">MMBase</a> documentation.
    </p><p xmlns="">
      For questions and remarks about this documentation mail to: 
      <a href="/cdn-cgi/l/email-protection#f6929995839b93988297829f9998b69b9b94978593d8998491"><span class="__cf_email__" data-cfemail="c0a4afa3b5ada5aeb4a1b4a9afae80adada2a1b3a5eeafb2a7">[email&#160;protected]</span></a></p><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Component Framework</title><link href="../style/documentation.css" rel="stylesheet" type="text/css" /><meta content="DocBook XSL Stylesheets V1.72.0" name="generator" /><meta name="description" content="This document describes the MMBase component framework." /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="icon" /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="shortcut icon" /><meta xmlns="" content="text/html; charset=utf-8" http-equiv="content-type" /></head><body><div xmlns="" class="navigation"><img alt="mmbase logo" src="../style/logo.png" /><h2>Component Framework</h2><p><a href="components.html#introduction">Introduction</a></p><p><a href="components.html#hello_world">Hello World!</a></p><p><a href="components.html#configuration">Configuration of a component</a></p><p><a href="components.html#N10071">The &lt;mm:component /&gt; tag</a></p><p><a href="components.html#N100AF">Frameworks and changing the behavior of the &lt;mm:url /&gt; and
    &lt;mm:include /&gt; tags</a></p><p><a href="components.html#action_flow">Action flow within the portlet engine / portal service</a></p><p><a href="components.html#cmsc">The CMS Container: portlets and components</a></p><p><a href="components.html#location_of_files">Some notes on the location of files</a></p><p><a href="components.html#references">References</a></p><hr /><p><a href="http://www.mmbase.org">MMBase</a></p><p><a href="../index.html">home</a></p></div><div class="article" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="N10001" />Component Framework</h1></div><div><div class="authorgroup"><strong class="authorgroup">Authors: </strong><span class="author"><span class="firstname">Nico</span> <span class="surname">Klasens</span>, </span><span class="author"><span class="firstname">Henk Hangyi</span> <span class="surname">Hangyi</span>, </span><span class="author"><span class="firstname">André</span> <span class="surname">van Toly</span></span><br /><strong class="authorgroup">Date: </strong>2007-02-09</div></div><div><div class="legalnotice"><a id="N10038" /><p>This software is OSI Certified Open Source Software. OSI Certified
      is a certification mark of the Open Source Initiative.</p><p>The license (Mozilla version 1.0) can be read at the MMBase site.
      See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/license" target="_top">http://www.mmbase.org/license</a></p></div></div><div /><div><div class="abstract"><p class="title"><b>Abstract</b></p><p>This document describes the MMBase component framework.</p></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="components.html#introduction">1. Introduction</a></span></dt><dt><span class="section"><a href="components.html#hello_world">2. Hello World!</a></span></dt><dt><span class="section"><a href="components.html#configuration">3. Configuration of a component</a></span></dt><dt><span class="section"><a href="components.html#N10071">4. The &lt;mm:component /&gt; tag</a></span></dt><dd><dl><dt><span class="section"><a href="components.html#N10076">4.1. Defaults</a></span></dt><dt><span class="section"><a href="components.html#N10083">4.2. Render and default css classes</a></span></dt><dt><span class="section"><a href="components.html#N10094">4.3. Mimetype</a></span></dt><dt><span class="section"><a href="components.html#N1009B">4.4. Absolutive and relative position of jsp-includes</a></span></dt><dt><span class="section"><a href="components.html#N100A0">4.5. Implicit and explicit parameters &lt;mm:param /&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="components.html#N100AF">5. Frameworks and changing the behavior of the &lt;mm:url /&gt; and
    &lt;mm:include /&gt; tags</a></span></dt><dd><dl><dt><span class="section"><a href="components.html#N100B4">5.1. Framework</a></span></dt><dt><span class="section"><a href="components.html#N100BF">5.2. Hello again! and goodbye to &lt;mm:treeinclude /&gt; and
      &lt;mm:treefile /&gt;</a></span></dt><dt><span class="section"><a href="components.html#N100E1">5.3. Linking within components</a></span></dt></dl></dd><dt><span class="section"><a href="components.html#action_flow">6. Action flow within the portlet engine / portal service</a></span></dt><dt><span class="section"><a href="components.html#cmsc">7. The CMS Container: portlets and components</a></span></dt><dd><dl><dt><span class="section"><a href="components.html#N10159">7.1. Using components as portlets</a></span></dt><dt><span class="section"><a href="components.html#N1015E">7.2. Using portlets as components</a></span></dt></dl></dd><dt><span class="section"><a href="components.html#location_of_files">8. Some notes on the location of files</a></span></dt><dd><dl><dt><span class="section"><a href="components.html#N10169">8.1. Applications and contributions</a></span></dt><dt><span class="section"><a href="components.html#N101AF">8.2. The CMS Container</a></span></dt><dt><span class="section"><a href="components.html#N101CB">8.3. Didactor</a></span></dt><dt><span class="section"><a href="components.html#N101FA">8.4. Component Framework (MMBase 1.9)</a></span></dt></dl></dd><dt><span class="section"><a href="components.html#references">9. References</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="introduction" />1. Introduction</h2></div></div></div><p>The component framework adds component based development to MMBase.
    To start appreciating component based development, lets turn to an example
    of integrating a poll component into your website. In the MMBase releases
    prior to 1.9, you had to include the poll.jsp into your jsp page. The most
    difficult part was that you had to change the url generated by the poll
    such that the answer provided by the user was posted to the right page.
    Moreover, the url also had to contain all other necessary information
    needed for other functionality on that same page. You also had to change
    the layout of poll.jsp so that the layout fits the layout of your website.
    By using the component framework the poll component can be integrated
    without the need to make a change to the component itself. The information
    to post the answer of the user to the right page is taken care of by the
    component framework and the layout of the poll follows the layout of the
    website automatically by means of the default css classes.</p><p>Standardisation of the way components interact with one another is
    another advantage of component based development. For instance you might
    want the votes on the poll to be registered in the users profile of the
    community component. In MMBase releases prior to 1.9 you had to "hardcode"
    the presence of the community component in your website. Within the
    component framework the poll component can simply ask whether the
    community component is present. More general in the component framework,
    components are aware of eachother presence and can respond to each others
    events. (TODO: is this already implemented ??)</p><p>Of course if it is only a poll that has to be integrated, the
    overhead of using component based development is much larger than the gain
    from reusing the component without any change. However most component for
    instance in Didactor consists of 50+ templates. Imagine what it would mean
    if you could reuse such a component without the need to review and change
    all of these templates.</p><p>Components can be accessed from jsp-pages directly or be used in a
    portlet engine / portal service. For use in jsp-pages MMBase offers tags
    in the MMBase taglibrary which put the components into action and render
    their content into the pages of a website. When using a portlet engine and
    portal service, like the CMS Container, this engine takes care of
    analyzing the client request, make the selected portlets execute, render
    their content and return the resulting page to the client.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="hello_world" />2. Hello World!</h2></div></div></div><p>Lets start with a simple example. The following configuration file
    for component "core" defines one block "components". This block has one
    renderer that can be used in the html &lt;body&gt; tag.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This file can be found in /config/components/core.xml. (see
      MMB-1391, the files for the MMBase core should be moved to /mmbase/core/
      )</p></div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;component
    name="core"
    defaultblock="components"
    xmlns="http://www.mmbase.org/xmlns/component"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.mmbase.org/xmlns/component
                        http://www.mmbase.org/xmlns/component.xsd"&gt;
  &lt;description xml:lang="en"&gt;MMBase core components&lt;/description&gt;
  &lt;block name="components" mimetype="text/html"&gt;
    &lt;body jsp="/mmbase/admin/components.jspx" /&gt;
  &lt;/block&gt;
&lt;/component&gt;</pre><p>The jsp-include "/mmbase/admin/components.jspx" could look
    like:</p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;div xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:jsp="http://java.sun.com/JSP/Page" 
      xmlns:mm="http://www.mmbase.org/mmbase-taglib-2.0"&gt;
  &lt;jsp:output doctype-root-element="html" doctype-public="-//W3C//DTD XHTML 1.0 Strict//EN" doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"/&gt;
  &lt;mm:content type="text/html" language="en" expires="0"&gt;
    &lt;h1&gt;Components admin page&lt;/h1&gt;
    Hello World!
  &lt;/mm:content&gt;
&lt;/div&gt;</pre><p>To render this, a jsp-page has to contain the following tag:</p><pre class="programlisting">&lt;mm:component name="core" block="components" render="body" /&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="configuration" />3. Configuration of a component</h2></div></div></div><p>The MMBase Component Frameworks adds a new directory to MMBase's
    configuration. This directory is specified in the mmbaseroot.xml and by
    default is: '/WEB-INF/config/components'. Note however that after
    installing MMBase you will not find any files here, because the default
    config files are stored inside the mmbase.jar.</p><p>The core of a component is the component.xml. It specifies the
    blocks in the component and the renderes within each block. The following
    example provides the ecards.xml for an ecard component.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;component
    name="ecards"
    defaultblock="home"
    xmlns="http://www.mmbase.org/xmlns/component"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.mmbase.org/xmlns/component
                        http://www.mmbase.org/xmlns/component.xsd"&gt;
  &lt;description&gt;Ecards component&lt;/description&gt;
  &lt;block name="home" mimetype="text/html"&gt;
    &lt;process jsp="ecards_init.jsp" /&gt;
    &lt;head jsp="ecards_head.jsp" /&gt;
    &lt;body jsp="ecards.jsp" /&gt;
  &lt;/block&gt;
  &lt;block name="select" mimetype="text/html"&gt;
    &lt;head jsp="ecards_head.jsp" /&gt;
    &lt;body jsp="ecards_selectecard.jsp" /&gt;
  &lt;/block&gt;
  &lt;block name="done" mimetype="text/html"&gt;
    &lt;process class="org.mmbase.ecards.Send" /&gt;
    &lt;head jsp="ecards_head.jsp" /&gt;
    &lt;body jsp="ecards_done.jsp" /&gt;
  &lt;/block&gt;
&lt;/component&gt;</pre><p>In the above example most renderes are jsp-includes. It is also
    possible to use java classes as renderer, for example &lt;process
    class="org.mmbase.ecards.Send" /&gt;.</p><p>The information available to the jsp files are the request
    parameters, session attributes and the ids and jspvars put into the scope
    by tags in which the &lt;mm:content /&gt; tag is contained (see also
    section 4.5 on parameters). For the java classes the information is
    available from HttpServletRequest request and HttpServletResponse
    response. Btw. by using request.getSession() the session in which the
    block is rendered can be accessed.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N10071" />4. The &lt;mm:component /&gt; tag</h2></div></div></div><p>This section provides an overview over the parameters and
    functionality of the &lt;mm:content /&gt; tag.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N10076" />4.1. Defaults</h3></div></div></div><p>In the "Hello World" example the following tag was used:</p><pre class="programlisting">&lt;mm:component name="core" block="components" render="body" /&gt;</pre><p>The default block to be used by &lt;mm:component /&gt; when the
      block attribute is omitted, can be specified by using the defaultblock
      attribute of the &lt;component /&gt; tag at the beginning of the
      component's configuration file. In the "Hello World" example it is
      defaultblock="components". If no defaultblock is specified the first
      block is considered to be the default block. The default renderer is
      body. By using the defaults the tag could be rewritten to:</p><pre class="programlisting">&lt;mm:component name="core" /&gt;</pre><p>When the renderer for a block is not specified, the default block
      of a component will be returned.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N10083" />4.2. Render and default css classes</h3></div></div></div><p>The renderes that are supported in the present implementation are:
      head, body, and process.</p><p>The process renderer of block is called implicitly, if the head or
      the body of that block is called. The process renderer of block will
      only be executed once per calling page. To give an example: if your page
      contains two polls, the processor of only one of these polls will be
      carried out after voting. (Which seems to be a defendable assumption in
      this epoch of single-moused computers) The process render does not
      produce any output.</p><p>The renderer for body with mimetype="text/html" by convention
      should render a &lt;div /&gt; with class="mm_c mm_c_&lt;component
      name&gt; mm_c_b_&lt;block name&gt; ${requestScope.className}". The
      framework will assign a value to request attribute
      ${requestScope.componentClassName} . For example a framework could
      render the poll component within the div &lt;class="mm_c mm_c_ecard
      mm_c_b_home left"&gt;. The basic implementation of the MMBase framework
      does not implement ${requestScope.className}, leaving the last part of
      the class definition empty.</p><p>The framework also renders an unique id for the &lt;div /&gt;
      containing a component. To summarize each renderer should
      contain:</p><pre class="programlisting">&lt;div
    class="mm_c mm_c_ecard mm_c_b_home ${requestScope.componentClassName}"
    id="${requestScope.componentId}"
&gt;</pre><p>In future the class specification should be extended with classes
      for icons and content images, which would give graphical designers also
      global control over what happens with icons and content images in a page
      (see</p><p>On default when no renderer is specified the render 'body' will be
      returned. If there is no body renderer defined in the component the
      first renderer specified in the component will be used as the default
      renderer. This could for instance be handy when you implement a
      component that only need to be rendered in the head of a page.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N10094" />4.3. Mimetype</h3></div></div></div><p>The mimetype can be used to indicate that the component is
      rendering special file types like images, attachments, etc. In the
      example above we could have used mimetype="application/xhtml+xml". Where
      Firefox interpretes this filetype correctly and will check the validity
      of the page, the present versions of Internet Explorer will prompt the
      user to download this page. Because of this IE bug it is better to use
      "text/html".</p><p>Of course the mime-type of a _component_ does not matter for the
      browser. Because you will hardly never send the block unwrapped to a
      client. So, the mimetype of a block only serves as an indication of the
      type of content it produces. application/xhtml+xml could indicate that
      besides HTML it is also valid _XML_, and is therefore fit to be used in
      a page which is application/xhtml+xml itself. Probably the XML can be
      used just as well in a text/html rendering page. (see also
      MMB-1389)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N1009B" />4.4. Absolutive and relative position of jsp-includes</h3></div></div></div><p>In the Hello World example at the beginning of this chapter the
      jsp include "/mmbase/admin/components.jspx" is positioned absolute to
      the root of the webapplication. By setting the request parameter
      doMakeRelative to true, the jsp include can be positioned relative to
      the jsp page that contains the &lt;mm:component /&gt; tag. TODO is this
      functionality necessary for the component framework, see also
      MMB-1390.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N100A0" />4.5. Implicit and explicit parameters &lt;mm:param /&gt;</h3></div></div></div><p>When the &lt;mm:component /&gt; tag is contained in another tag
      all the information from the containing tag is available to the
      &lt;mm:component /&gt; tag. For instance in the situation &lt;mm:cloud
      jspvar="cloud"&gt;&lt;mm:component name="core" /&gt;&lt;/mm:cloud&gt;
      the components.jspx could contain &lt;%= cloud.getUser().getIdentifier()
      %&gt;.</p><p>When it is necessary to include extra parameters this can be done
      by using the &lt;mm:param /&gt; tag.</p><p>Some examples:</p><pre class="programlisting">&lt;!-- this piece uses the poll component to show two polls --&gt;
&lt;mm:node number="first_poll"&gt;&lt;mm:component name="poll"&gt;&lt;mm:node&gt;
&lt;mm:node number="second_poll"&gt;&lt;mm:component name="poll"&gt;&lt;mm:node&gt;</pre><p>Parameters need to be specified in configuration. The 'my_game'
      example should be configured in a block that could look like
      this:</p><pre class="programlisting">&lt;block name="default" mimetype="text/html"&gt;
  &lt;description xml:lang="en"&gt;The first block of this game.&lt;/description&gt;
  &lt;body jsp="/mygame/first.jsp"&gt;
    &lt;param name="level" type="string" /&gt;
  &lt;/body&gt;
&lt;/block&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N100AF" />5. Frameworks and changing the behavior of the &lt;mm:url /&gt; and
    &lt;mm:include /&gt; tags</h2></div></div></div><p>Next to basic reference implementation of the component framework
    included in the MMBase core other frameworks exist, for instance the CMS
    Container and Patmos. Each framework is providing the context in which
    components are rendered. This is done by changing the behavior of the
    &lt;mm:url /&gt; and the &lt;mm:include /&gt; tag. The next section shows
    how frameworks are implemented. The "Hello Again!" example gives an
    example of using a framework.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N100B4" />5.1. Framework</h3></div></div></div><p>A framework is an implementation of
      org.mmbase.framework.Framework. By implementing the method
      Framework.getUrl() the behaviour of &lt;mm:url /&gt; and &lt;mm:include
      /&gt; can be changed. This can be used to change the layout and the
      includes used in the page, based on the parameters passed to that
      page.</p><p>The framework that will be used for rendering the components in an
      MMBase instance is specified in mmbaseroot.xml, by using the
      parameter</p><pre class="programlisting">&lt;property name="framework"&gt; ... &lt;/property&gt;</pre><p>If no framework is specified in mmbaseroot.xml the
      org.mmbase.framework.BasicFramework will be used.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N100BF" />5.2. Hello again! and goodbye to &lt;mm:treeinclude /&gt; and
      &lt;mm:treefile /&gt;</h3></div></div></div><p>The use of the Framework functionality is shown by the following
      "Hello again!" example.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;component
    xmlns="http://www.mmbase.org/xmlns/component"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.mmbase.org/xmlns/component http://www.mmbase.org/xmlns/component.xsd"
    name="helloworld"&gt;
  &lt;description&gt;Hello Again&lt;/description&gt;
  &lt;block name="home" mimetype="text/html"&gt;
    &lt;head jsp="hello_head.jsp" /&gt;
  &lt;/block&gt;
&lt;/component&gt;</pre><p>The jsp-include hello_head looks like:</p><pre class="programlisting">&lt;%@page language="java" contentType="text/html;charset=utf-8" session="false"%&gt;
&lt;%@taglib uri="http://www.mmbase.org/mmbase-taglib-1.0" prefix="mm"%&gt;
&lt;mm:content type="text/html" language="en"&gt;
&lt;mm:cloud&gt;
   &lt;title&gt;Hello world&lt;/title&gt;
   &lt;link rel="stylesheet" type="text/css" href="&lt;mm:url page="css/hello.css" component="hello" /&gt;" /&gt;
&lt;/mm:cloud&gt;
&lt;/mm:content&gt;</pre><p>The jsp-page that uses this component looks like:</p><pre class="programlisting">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd"&gt;
&lt;%@page import="org.mmbase.framework.*"%&gt;
&lt;%@page import="org.mmbase.util.functions.*"%&gt;
&lt;%@page language="java" contentType="text/html;charset=utf-8" session="false"%&gt;
&lt;%@taglib uri="http://www.mmbase.org/mmbase-taglib-1.0" prefix="mm"%&gt;
&lt;mm:content type="text/html" language="en"&gt;
&lt;mm:cloud&gt;
&lt;mm:import externid="component" /&gt;
&lt;head&gt;
   &lt;!-- parameters are case sensitive -&gt;
   &lt;mm:component name="hello" block="home" render="head" /&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;h1&gt;Hello again!&lt;/h1&gt;
&lt;/body&gt;
&lt;/mm:cloud&gt;
&lt;/mm:content&gt;</pre><p>The call to &lt;mm:url page="css/hello.css" component="hello"
      /&gt; is picked up by the getUrl() method of the framework which is
      specified for this MMBase instance.</p><p>This method</p><pre class="programlisting">getUrl(String page, String component, Cloud cloud, PageContext pageContext, List params)</pre><p>could for instance call</p><pre class="programlisting">UrlResolver.findUrl(component + "/" + page, cloud, pageContext, params)</pre><p>In the findUrl() method the params can be used to select different
      css-es for different portals. The code which is used for this looks
      something like:</p><pre class="programlisting">Node portalNode = cloud.getNode((String)params.get("portal"));
String finalpage = findUrl(page, portalNode, mapNode);
if (finalpage != null) {
   return File.separator + finalpage;
}</pre><p>The example framework presented here thus provides the
      functionality to use one set of templates, but have subsites with
      different layouts and subsite-specific includes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you are familiar with &lt;mm:treeinclude /&gt; and
        &lt;mm:treefile /&gt; you will probably already have recognized that
        this framework replaces the functionality of both these tags.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N100E1" />5.3. Linking within components</h3></div></div></div><p>In the above examples we saw the use of &lt;mm:url /&gt; to
      include a stylesheet. The tags &lt;mm:url /&gt; and &lt;mm:link /&gt;
      can also be used to link blocks with each other or to specify links
      within a block.</p><pre class="programlisting">&lt;mm:link page="servers" referids="_@server"&gt;
  &lt;a href="${_}"&gt;&lt;mm:field name="name" /&gt;&lt;/a&gt;
&lt;/mm:link&gt;
</pre><p>The 'page' attribute is used to specify the block to link
      to..</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="action_flow" />6. Action flow within the portlet engine / portal service</h2></div></div></div><p>To give an idea of how a portlet engine / portal service works this
    sections gives an overview of the flow of actions that take place when a
    client calls an url:</p><div class="orderedlist"><ol type="1"><li><p>Client calls url</p></li><li><p>Tomcat (or other application server) routes url to web
        application of the portal</p></li><li><p>A servlet inside the portal web application receives the
        url</p></li><li><p>Portal servlet will analyze the request</p><div class="itemizedlist"><ul type="disc"><li><p>global navigation path to a page</p></li><li><p>local navigation for the portlet (indicates which portlet is
            active in this call)</p></li><li><p>window state for each portlet</p></li><li><p>portlet mode for each portlet</p></li><li><p>render parameters for each portlet</p></li><li><p>action parameters from query string</p><p>Action parameters correspond to our "processor" of a
            block</p></li></ul></div></li><li><p>Start of action phase</p><div class="itemizedlist"><ul type="disc"><li><p>Portal servlet resolves portlet instance which user wants to
            interact with</p></li><li><p>Portal servlet creates ActionRequest and ActionResponse
            objects</p></li><li><p>Portal servlet dispatches ActionRequest to the servlet which
            hosts the portlet instance for the action phase and sends the
            action parameters</p></li><li><p>Portlet instance processes the action parameters maybe with
            the help of its own presentation framework (struts, jsf, jsp,
            tapestry, wicket, whatever)</p></li><li><p>Portlet instance can change things in the request, session,
            preferences, external system, database, etc.</p></li><li><p>Portlet instance modifies ActionResponse to tell the Portal
            servlet what should happen next. Redirect to client or render
            phase.</p></li><li><p>Portal Servlet receives ActionResponse and acts on it</p></li></ul></div></li><li><p>Start of render phase</p><div class="itemizedlist"><ul type="disc"><li><p>Portal servlet resolves page object from global
            navigation.</p></li><li><p>Portal servlet retrieves all portlet instances on the page.
            For each portlet instance</p><div class="itemizedlist"><ul type="circle"><li><p>Portal servlet creates RenderRequest and RenderResponse
                objects</p></li><li><p>Portal servlet dispatches RenderRequest to the servlet
                which hosts the portlet instance.</p></li><li><p>Portlet instances reads portlet mode and window
                state.</p></li><li><p>Portlet instances calls his own presentation framework
                (struts, jsf, jsp, tapestry, wicket, whatever).</p></li><li><p>Portlet instances writes markup fragment to
                RenderResponse.</p></li></ul></div></li><li><p>Portal servlet retrieves page template</p></li><li><p>Portal servlet decorates portlet RenderResponse outputs with
            window and portlet mode buttons and inserts it in the page
            template.</p></li><li><p>Final result is written to client response</p></li><li><p>Portal servlet returns response to the client.</p></li></ul></div></li></ol></div><p>In the above flow no separation is made between portal service and
    the portlet engine (for instance pluto). The portlet engine provides the
    runtime environment for the portlet instances. The portal service does all
    page related stuff.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cmsc" />7. The CMS Container: portlets and components</h2></div></div></div><p>The CMS Container is one of the MMBase contributions. For
    documentation of the CMS Container see the reference list at the end of
    this document. This section addresses the relation between portlets and
    components.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N10159" />7.1. Using components as portlets</h3></div></div></div><p>A wrapper class is developed in the CMS Container, which makes it
      possible to use any MMBase component in the CMS Container (done by the
      classes MMComponentPortlet and MMBaseFramework) This means that for the
      components the CMS Container will use the components.xml from the
      component instead of the project.xml that is used for the portlets in
      the CMS Container.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N1015E" />7.2. Using portlets as components</h3></div></div></div><p>The other way around the situation is more difficult. When a
      portlet depends on the objectmodel of the CMS Container it is not
      possible to rewrite it to an MMBase component, that can be reused
      outside the CMS Container. Only portlets that do not depend explicitly
      on the objectmodel of the CMS Container can be rewriten into components.
      The present version of the CMS Container in the MMBase CVS does not
      contain examples of such portlets. But don't get worried: portlets like
      calender, playlist, etc. which are now being developed will be added as
      components later.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="location_of_files" />8. Some notes on the location of files</h2></div></div></div><p>It is handy to use the same structure to store the files of a
    component within an application or contribution. When it comes to
    building, the exact location is of minor importance because the build
    process can reshuffle directories to get them into the right location in
    the build. Below follows an overview of how files are structured at the
    moment.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N10169" />8.1. Applications and contributions</h3></div></div></div><p>In the 1.8 MMBase applications and contributions files are stored
      in the following directories:</p><div class="itemizedlist"><ul type="disc"><li><p>MyApplication</p><div class="itemizedlist"><ul type="circle"><li><p>config</p><div class="itemizedlist"><ul type="square"><li><p>applications</p><div class="itemizedlist"><ul type="disc"><li><p>MyApplication.xml</p></li><li><p>MyApplication</p><div class="itemizedlist"><ul type="circle"><li><p>builders</p></li></ul></div></li></ul></div></li><li><p>builders</p></li><li><p>functions</p></li><li><p>log</p></li><li><p>modules</p></li><li><p>security</p></li><li><p>thememanager</p></li></ul></div></li><li><p>documentation</p></li><li><p>packaging: what to do this?</p></li><li><p>templates</p></li><li><p>src</p></li><li><p>META-INF</p></li><li><p>WEB-INF</p></li><li><p>readme.txt</p></li><li><p>build.xml</p></li></ul></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N101AF" />8.2. The CMS Container</h3></div></div></div><p>The CMS Container contains several portlets, which all can be
      viewed as seperate applications. These portlets can be found in
      /contributions/CMSContainer/cmsc. For the CMS Container the Maven
      preferred way of storing files is used. The files of these portlets are
      stored in the following directories:</p><div class="itemizedlist"><ul type="disc"><li><p>config</p></li><li><p>resources: resource bundles and property files</p></li><li><p>src</p><div class="itemizedlist"><ul type="circle"><li><p>java</p></li><li><p>tld</p></li><li><p>webapp</p></li></ul></div></li><li><p>project.xml</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N101CB" />8.3. Didactor</h3></div></div></div><p>In Didactor, the e-learning platform that is based on MMBase, the
      components are structured as follows:</p><div class="itemizedlist"><ul type="disc"><li><p>mycomponent</p><div class="itemizedlist"><ul type="circle"><li><p>config</p><div class="itemizedlist"><ul type="square"><li><p>applications</p><div class="itemizedlist"><ul type="disc"><li><p>MyComponent</p><div class="itemizedlist"><ul type="circle"><li><p>MyComponent.xml</p></li></ul></div></li></ul></div></li><li><p>components</p><div class="itemizedlist"><ul type="disc"><li><p>mycomponent.xml</p></li></ul></div></li><li><p>translations</p></li></ul></div></li><li><p>java</p></li><li><p>lib</p></li><li><p>templates</p></li><li><p>webinf</p></li></ul></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N101FA" />8.4. Component Framework (MMBase 1.9)</h3></div></div></div><p>For the file structure of components the following principle will
      be used.</p><div class="itemizedlist"><ul type="disc"><li><p>MyContribution</p><div class="itemizedlist"><ul type="circle"><li><p>components</p><div class="itemizedlist"><ul type="square"><li><p>mycomponent1</p><div class="itemizedlist"><ul type="disc"><li><p>config</p><div class="itemizedlist"><ul type="circle"><li><p>mycomponent.xml</p></li><li><p>model.xml</p></li><li><p>builders</p></li><li><p>data</p></li><li><p>functions</p></li><li><p>log</p></li><li><p>modules</p></li><li><p>security</p></li></ul></div></li><li><p>documentation</p></li><li><p>editwizards</p></li><li><p>templates</p></li><li><p>src</p></li><li><p>resources</p></li><li><p>tld / META-INF</p></li><li><p>WEB-INF</p></li><li><p>project.xml</p></li><li><p>readme.txt</p></li></ul></div></li><li><p>mycomponent2</p></li><li><p>mycomponent3</p></li></ul></div></li><li><p>documentation</p></li><li><p>build.xml</p></li><li><p>readme.txt</p></li></ul></div></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>In the new structure the applications directory is replaced by
        the model.xml file in the config directory of the component and a data
        directory containing the default data for the component, the "apps1"
        xml dump.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The editwizards are stored in a seperate directory. In this way
        the build process itself can move the editwizards to the directory
        where the target application expects them.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The lib directory is not necessary because the needed jar files
        are specified in the project.xml and will be downloaded during the
        build.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="references" />9. References</h2></div></div></div><p>The following documents can be used for further reading.</p><div class="itemizedlist"><ul type="disc"><li><p>MMBase Component Framework projectpage <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/mmcf" target="_top">
        http://www.mmbase.org/mmcf</a></p></li><li><p>Presentation on JSR168 by Nico Klasens <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/mmbase/attachments/50434/JSR168.zip" target="_top">http://www.mmbase.org/mmbase/attachments/50434/JSR168.zip</a></p></li><li><p>An MMBase Component Framework by Johannes Verelst <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/mmbase/attachments/50347/MMBase_framework_-_tech.doc" target="_top">
        http://www.mmbase.org/mmbase/attachments/50347/MMBase_framework_-_tech.doc</a></p></li><li><p>Design CMS Container by Nico Klasens <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://cmsc.finalist.com/Design%20CMSC.pdf" target="_top">http://cmsc.finalist.com/Design
        CMSC.pdf</a> or <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://cvs.mmbase.org/viewcvs/*checkout*/speeltuin/applications/cmsc/Design%20CMSC.pdf" target="_top">http://cvs.mmbase.org/viewcvs/*checkout*/speeltuin/applications/cmsc/Design
        CMSC.pdf</a></p></li><li><p>What Is a Portlet <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.onjava.com/lpt/a/6208" target="_top">http://www.onjava.com/lpt/a/6208</a></p></li></ul></div></div></div><hr xmlns="" /><p xmlns="">
      This is part of the <a href="http://www.mmbase.org">MMBase</a> documentation.
    </p><p xmlns="">
      For questions and remarks about this documentation mail to: 
      <a href="/cdn-cgi/l/email-protection#b2d6ddd1c7dfd7dcc6d3c6dbdddcf2dfdfd0d3c1d79cddc0d5"><span class="__cf_email__" data-cfemail="47232824322a22293326332e2829072a2a2526342269283520">[email&#160;protected]</span></a></p><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>
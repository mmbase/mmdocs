<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>MMBase Applications</title><link href="../style/documentation.css" rel="stylesheet" type="text/css" /><meta content="DocBook XSL Stylesheets V1.72.0" name="generator" /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="icon" /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="shortcut icon" /><meta xmlns="" content="text/html; charset=utf-8" http-equiv="content-type" /></head><body><div xmlns="" class="navigation"><img alt="mmbase logo" src="../style/logo.png" /><h2>MMBase Applications</h2><p><a href="applications.html#N10033">Introduction</a></p><p><a href="applications.html#N10054">Example: the MyNews Application</a></p><p><a href="applications.html#N10059">The Application Configuration Files</a></p><p><a href="applications.html#N10157">Content XML-format</a></p><p><a href="applications.html#N1017C">How to Backup an MMBase Application</a></p><p><a href="applications.html#N1019C">How to Install a MMBase application</a></p><p><a href="applications.html#N101CE">Necessary Java Functionality</a></p><p><a href="applications.html#N101D3">Including The Frontend</a></p><hr /><p><a href="http://www.mmbase.org">MMBase</a></p><p><a href="../index.html">home</a></p></div><div class="article" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="N10001" />MMBase Applications</h1></div><div><div class="authorgroup"><strong class="authorgroup">Authors: </strong><span class="author"><span class="firstname">Henk</span> <span class="surname">Hangyi</span>, </span><span class="author"><span class="firstname">Pierre</span> <span class="surname">van Rooden</span></span><br /><strong class="authorgroup">Date: </strong>2003-02-27</div></div><div><div class="legalnotice"><a id="N1001A" /><p>This software is OSI Certified Open Source Software. OSI Certified
      is a certification mark of the Open Source Initiative.</p><p>The license (Mozilla version 1.0) can be read at the MMBase site.
      See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/license" target="_top">http://www.mmbase.org/license</a></p></div></div><div /></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="applications.html#N10033">1. Introduction</a></span></dt><dt><span class="section"><a href="applications.html#N10054">2. Example: the MyNews Application</a></span></dt><dt><span class="section"><a href="applications.html#N10059">3. The Application Configuration Files</a></span></dt><dd><dl><dt><span class="section"><a href="applications.html#N1005E">3.1. The Application Description File</a></span></dt><dt><span class="section"><a href="applications.html#N10107">3.2. Builders Used by the Application</a></span></dt><dt><span class="section"><a href="applications.html#N10115">3.3. The Backup Scenario: backup.xml</a></span></dt></dl></dd><dt><span class="section"><a href="applications.html#N10157">4. Content XML-format</a></span></dt><dt><span class="section"><a href="applications.html#N1017C">5. How to Backup an MMBase Application</a></span></dt><dt><span class="section"><a href="applications.html#N1019C">6. How to Install a MMBase application</a></span></dt><dt><span class="section"><a href="applications.html#N101CE">7. Necessary Java Functionality</a></span></dt><dt><span class="section"><a href="applications.html#N101D3">8. Including The Frontend</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N10033" />1. Introduction</h2></div></div></div><p>MMBase provides functionality to package an entire website build on
    top of MMBase. To package an entire website can be necessary. For
    instance, if you need to:</p><div class="itemizedlist"><ul type="disc"><li><p>migrate your website from one database to another,</p></li><li><p>migrate your website from one MMBase version to another,</p></li><li><p>want to clean-up your object-cloud during or at the end of
        implementing a website in MMBase.</p></li></ul></div><p>An MMBase application consists of:</p><div class="itemizedlist"><ul type="disc"><li><p>configuration files: description of the cloud-structure,
        builders used in the cloud and the backup/export scenario,</p></li><li><p>the website's content exported in XML-format,</p></li><li><p>necessary Java functionality contained in MMBase modules,</p></li><li><p>the frontend of your website: a set of JSP-templates, XSLT,
        flash-animations, etc.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The term "application" is often only used for the configuration
      files and the website's content. Since a website is not complete without
      its templates and the necessary modules, this documentation also
      describes how you take care that templates and modules are also added to
      the package.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N10054" />2. Example: the MyNews Application</h2></div></div></div><p>A number of demo applications are included in the MMBase release,
    like MyNews (an example of a magazine with news articles) and MyYahoo (an
    example of a page like the topic/url/search kind of interface first shown
    on yahoo and in the Netherlands known as startpagina.nl). You can easily
    install the MyNews application via the /mmexamples/install.jsp and have a
    look at the application in action at /mmexamples/jsp/mynews/index.jsp. In
    this document we will have a close look at the MyNews application and and
    use it to show how you can package your own MMBase applications.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N10059" />3. The Application Configuration Files</h2></div></div></div><p>All configuration files of the applications present in your MMBase
    installation are located in the directory /WEB-INF/config/applications. If
    you have a look at this directory, you will see that it contains a file
    called MyNews.xml and a directory MyNews. All MMBase applications follow
    this structure: an XML-file with the name of the application and a
    directory with the name of the application.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N1005E" />3.1. The Application Description File</h3></div></div></div><p>The XML-file with the name of the application contains the
      description of the cloud-structure used by that application. We will
      have a closer look at MyNews.xml to see the different parts:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="sgmltag-xmlpi">&lt;?xml version="1.0"
          encoding="UTF-8"?&gt;</code> <code class="sgmltag-element">&lt;!DOCTYPE
          application PUBLIC "-//MMBase/DTD application config 1.0//EN"
          "http://www.mmbase.org/dtd/application_1_0.dtd"&gt;</code></p><p>Every xml-document must have a reference to its document type
          definition or dtd. For the applications version as implemented in
          MMBase 1.6, the <code class="filename">application_1_0.dtd</code> is
          used.</p></li><li><p><code class="sgmltag-element">&lt;application name="MyNews" maintainer="mmbase.org"
          version="1" auto-deploy="false"&gt; ...
          &lt;/application&gt;</code></p><p>The whole description of the cloud-structure is enclosed by
          the <code class="sgmltag-element">application</code> tag. The attributes <code class="sgmltag-attribute">name</code>, <code class="sgmltag-attribute">maintainer</code>, and <code class="sgmltag-attribute">version</code> can be used to label the
          application. The preferred way of writing names of applications is
          to use capitalized words. The maintainer is the domain name of the
          organization or person who takes the responsibility for updating
          this application. The version number can be used to distinguish
          different versions of your application. The property <code class="sgmltag-attribute">auto-deploy</code> is important. The
          application will automatically be installed the next time MMBase is
          restarted, when auto-deploy is set to "true" and the application was
          not already present in your MMBase installation. When auto-deploy is
          "false" you can install the application manually via the MMBase
          administrator pages (See the chapter "How to install an MMBase
          application" for more information on this topic).</p></li><li><p><code class="sgmltag-element">&lt;neededbuilderlist&gt;&lt;builder
          maintainer="mmbase.org" version="1"&gt;mags&lt;/builder&gt; ....
          &lt;/neededbuilderlist&gt;</code></p><p>The <code class="sgmltag-attribute">neededbuilderlist</code> tag
          contains a list of all the builders that are necessary to run this
          application. Both the builders of regular objects and the builders
          used to create relations have to be listed here.</p></li><li><p><code class="sgmltag-element">&lt;neededreldeflist&gt;&lt;reldef source="related"
          target="related" direction="bidirectional" guisourcename="Related"
          guitargetname="Related" builder="insrel" /&gt; ...
          &lt;/neededreldeflist&gt;</code></p><p>The <code class="sgmltag-attribute">neededreldeflist</code> tag
          contains a list of all relation roles that have to be defined for
          this application. When you use the MMBase editors to have a look at
          the RelationDefinition objects in your MMBase installation, you will
          see how closely the <code class="sgmltag-attribute">&lt;reldef ...
          /&gt;</code> descriptions follow these objects.</p><p>The most import attributes of every <code class="sgmltag-attribute">reldef</code> tag below <code class="sgmltag-attribute">neededreldeflist</code> are `source' and
          `builder', and the function of a `reldef' is actually to connect
          those two. Another word for 'source' is 'role' (as it is called
          often for example in taglib attributes). The `builder' refers to the
          actual database table in which the relations can be stored, and
          therefore defines which fields the relations of this type
          have.</p></li><li><p><code class="sgmltag-element">&lt;allowedrelationlist&gt;&lt;relation from="mags"
          to="news" type="posrel" /&gt; ...
          &lt;/allowedrelationlist&gt;</code></p><p>The <code class="sgmltag-element">allowedrelationlist</code> list what type of
          relation (what roles) should be used to relate two object of
          specified type. When you use the MMBase editors to have a look at
          the RelationType objects in your MMBase installation, you will see
          how closely the <code class="sgmltag-attribute">&lt;relation...
          /&gt;</code> descriptions follow these objects.</p><p>The `from' and `to' attributes both refer to builder names
          (and could also have been called `sourcebuilder' and
          `destinationbuilder' or `sourcenodetype' and `destinationnodetype').
          The `type' attribute then actually defines the role for this allowed
          relation, so these correspond to the `source' attributes of the
          <code class="sgmltag-attribute">reldef</code> tags.</p></li><li><p><code class="sgmltag-element">&lt;datasourcelist&gt;&lt;datasource builder="mags"
          path="MyNews/mags.xml" /&gt; ...
          &lt;/datasourcelist&gt;</code></p><p>The <code class="sgmltag-attribute">datasourcelist</code> tag
          specifies where MMBase has to look for the content to fill each
          object when case the application is installed. The <code class="sgmltag-attribute">datasourcelist</code> only contains the
          datasources of regular objects and does not contain relations. When
          images or attachments are included in the application, MMBase will
          use subdirectories of the MyNews directory to store the images and
          attachments. The MyNews/images.xml and the MyNews/attachments.xml
          contain the handles to these files.</p></li><li><p><code class="sgmltag-element">&lt;relationsourcelist&gt;&lt;relationsource
          builder="insrel" path="MyNews/insrel.xml" /&gt; ...
          &lt;/relationsourcelist&gt;</code></p><p>The <code class="sgmltag-attribute">relationsourcelist</code>
          tag specifies where MMBase has to look for the content to fill each
          relation in case the application is installed.</p></li><li><p><code class="sgmltag-element">&lt;contextsourcelist&gt;&lt;contextsource
          path="MyNews/backup.xml" type="depth"
          goal="backup"/&gt;&lt;/contextsourcelist&gt;</code></p><p>The <code class="sgmltag-attribute">contextsource</code> tag
          specifies where MMBase has to find the backup (export) scenario for
          this application. The <code class="sgmltag-attribute">path</code>
          specifies where to find the file. the <code class="sgmltag-attribute">type</code> attribute specifies the export
          algorithm to use. Currently, only 'depth' and 'full' (see below) are
          supported. The <code class="sgmltag-attribute">goal</code> is a
          freeform field used to identify the contextsource to the user</p></li><li><p>&lt;contextsourcelist&gt;&lt;contextsource type="full"
          goal="backup"/&gt;&lt;/contextsourcelist&gt;</p><p>Using type="full" provides the possibility of making a full
          backup of your objectcloud in XML.</p></li><li><p><code class="sgmltag-element">&lt;description&gt;&lt;![CDATA[MyNews is ...]
          ]&gt;&lt;/description&gt;</code></p><p>The <code class="sgmltag-attribute">description</code> is used
          as an introduction to the application in the MMBase install pages
          and the MMBase admin interface.</p></li><li><p><code class="sgmltag-element">&lt;install-notice&gt;&lt;![CDATA[The MyNews
          application is installed ...]
          ]&gt;&lt;/install-notice&gt;</code></p><p>The <code class="sgmltag-attribute">install-notice</code> is
          shown in the MMBase install pages and the MMBase admin interface
          after successful installation of the application. It is not possible
          to add messages to the application configuration file, which are
          shown in case the application fails to install.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N10107" />3.2. Builders Used by the Application</h3></div></div></div><p>The builders specified in the <code class="sgmltag-element">neededbuilderlist</code>
      can be found in the application folder under
      <code class="filename">[applicationname]/builders</code>. I.e., for the MyNews
      application, the builders can be found in the directory
      <code class="filename">MyNews/builders/</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="N10115" />3.3. The Backup Scenario: backup.xml</h3></div></div></div><p>The <code class="sgmltag-element">contextsource</code> specifies where the file with
      the backup scenario for this application is located - specified in its
      <code class="sgmltag-attribute">path</code> attribute. For MyNews we saw
      that this is "MyNews/backup.xml".</p><p>Most applications come with a 'backup.xml' file that describes the
      startpoint for exporting data (as described below). It is not necessary
      to specify a file - i.e. if an application is only meant to be installed
      and not exported. You can also use other filenames (though 'backup.xml'
      is the convention) or specify multiple contextsources. In the latter
      case, the administration pages require the user to choose the
      contextsource with which to make the export, using the freeform <code class="sgmltag-attribute">goal</code> attribute to give user-feedback on the
      intention of the contextsource.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>While we speak about "backup" here, the system can also be used
        to simply export certain parts of your cloud, for instance for sharing
        with others, or porting data from a test environment to a production
        environment.</p></div><p>The way MMBase makes a backup of the content in an application in
      the form of XML-files needs special attention. To be able to determine
      which objects are necessary for an application and have to be
      incorporated in the backup and which objects are not, MMBase uses a
      backup algorithm. The backup algorithm to use is specified in the
      <code class="sgmltag-attribute">type</code> attribute. Currently, the only
      algorithm available for export is 'depth' (Future implementations may
      involve more algorithms).</p><p>The 'depth' backup algorithm starts at the startnode specified in
      the context source (i.e. "backup.xml") file. The startnode is written to
      the appropriate XML backup file and MMBase searches for nodes related to
      this startnode, which are not already included in the backup. These new
      nodes are now taken as the startnodes and the whole process repeats as
      long as their are nodes found that have not already been included in the
      backup or until the maximum depth as specified in backup.xml is
      reached.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The backup scenario that MMBase uses is a very elegant way to
        clean up the content in your application from objects that are not
        used anymore or that have been the result from mistakes in the
        development process. However a drawback of this scenario is that
        objects that can not be reached from the startnodes specified in the
        context source file will not be incorporated in the backup.</p></div><p>If you have a look at this file you see that it consists of the
      following tags:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="sgmltag-element">&lt;contextdepth&gt;</code></p><p>The tag &lt;contextdepth&gt; encloses the specification of the
          backup scenario.</p></li><li><p><code class="sgmltag-element">&lt;startnode&gt;</code></p><p>The startnode specifies which node should be used by MMBase as
          the start of the backup algorithm. The startnode can be specified in
          one of two ways:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="sgmltag-element">&lt;builder&gt;mags&lt;/builder&gt;&lt;where&gt;title=='MyNews
              magazine'&lt;/where&gt;</code></p><p>The backup algorithm starts at the mags object with the
              title "MyNews magazine". If there are multiple objects that fit
              the algorithm, the first one found is chosen. It is not possible
              to determine which object that will be.</p></li><li><p><code class="sgmltag-element">&lt;startnode alias="mynewsmagazine"
              /&gt;</code></p><p>The backup algorithm starts at the object with the
              objectalias "mynewsmagazine".</p></li></ul></div></li><li><p><code class="sgmltag-element">&lt;depth&gt;5&lt;/depth&gt;</code></p><p>Specifies the depth of the search (the maximum number of
          nested searches) used in the backup algorithm (in the example this
          is 5 levels deep).</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N10157" />4. Content XML-format</h2></div></div></div><p>The application configuration files can be used to backup the
    content of the website in XML-files. When you look at the
    <code class="filename">/WEB-INF/applications/MyNews/</code> directory, you see the
    XML files with the content of the MyNews application. If you open for
    instance <code class="filename">mags.xml</code> with a text-editor, you
    find:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="sgmltag-element">&lt;mags
        exportsource="mmbase://www.mmbase.org/mmexamples/mynews"
        timestamp="20020516170724"&gt;</code></p><p>The <code class="sgmltag-element">mags</code> tag encloses the
        content of the mag objects. The attributes of the mags tag give an
        indication from where the backup of the application is made (TODO the
        semantic of exportsource is not clear) and specifies the time when the
        backup of the application has been made.</p></li><li><p><code class="sgmltag-element">&lt;node number="8495" owner="system"
        alias="default.mags"&gt;</code></p><p>The <code class="sgmltag-element">node</code> tag specifies a node
        with its number, owner and aliases (if any). It also includes tags and
        content for each field in the node (using the fieldname as the name of
        the tag).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>MMBase renumbers the objects in the application when restoring
          the application. This means that for example the node with alias
          "default.mags" is very likely to have a different node number than
          "8495". This is another reason to not use numbers of objects in your
          templates.</p></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N1017C" />5. How to Backup an MMBase Application</h2></div></div></div><p>Ones you finished the [application].xml of your MMBase application,
    you can use it to make a backup of the content in your website in XML. To
    this end: <div class="orderedlist"><ol type="1"><li>go the admin-interface on /mmadmin/jsp/</li><li>click on "admin" and log on (in a fresh MMBase install the
          loginname is admin and the password is admin2k)</li><li>click on "applications"</li><li>select your application by clicking one of the triangles at
          the right side of the table</li><li>find the "Save [application]" action in the middle of the
          page</li><li>specify the location where you want the backup to be
          stored</li><li>select the goal of the backup in the combobox. This goals
          selects the contextsource to use for the backup - most of the time
          you will have only one choice, which will be preselected.</li><li>click on "Yes" to make a backup of the
          application</li></ol></div></p><p>After you clicked the "Yes" button, MMBase shows some statistics of
    the backup procedure. When using the configuration files of your
    application for the first time, it is recommended to examine these
    statistics closely. It might be that you forgot to specify a relation or
    that some parts of the content can not be reached from the startnodes.
    This is the first spot to notice such errors!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N1019C" />6. How to Install a MMBase application</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Instead of installing an MMBase application the term "restoring"
      (for a backup) or "loading" an MMBase application is frequently
      used.</p></div><p>You can install (or restore) a MMBase application as follows:
    <div class="orderedlist"><ol type="1"><li>put the application configuration files in the
          <code class="filename">/WEB-INF/config/applications/</code>
          directory</li><li>put the XML content files in the
          <code class="filename">/WEB-INF/config/applications/[applicationname]</code>
          directory</li><li>place the builders of the application in
          <code class="filename">/WEB-INF/config/builders/</code> or one of its
          subdirectories. You can also place the builders in the
          <code class="filename">/WEB-INF/config/applications/[applicationname]/builders</code>
          directory, and let the application install your builders. Note that
          this requires that MMBase has the right to write in the
          configuration directory</li><li>go the admin-interface on /mmadmin/jsp/</li><li>click on "admin" and log on (in a fresh MMBase install the
          loginname is admin and the password is admin2k)</li><li>click on "applications"</li><li>select your application by clicking one of the triangles at
          the right side of the table</li><li>find the action "Install [application] " at the top of the
          page and click on "Yes"</li><li>MMBase will respond with the install-notice as specified in
          the [applicationname].xml</li></ol></div></p><p>Another way to restore an MMBase application is set auto-deploy to
    "true " after step (3) and restart MMBase. You can view the log file to
    see of the restore of the application was carried out correctly.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N101CE" />7. Necessary Java Functionality</h2></div></div></div><p>Some MMBase applications need additional functionality contained in
    one of the MMBase modules. For instance, it might be possible that your
    application requires the MMBase sendmail module to send email or that it
    is using the communityprc module for the forum. When packaging your
    application be sure to notice all necessary modules in the install
    instructions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="N101D3" />8. Including The Frontend</h2></div></div></div><p>The frontend of your website (a set of JSP-templates, XSLT,
    flash-animations, etc.) will be located in the default-web-app directory
    and/or in one or more subdirectories. For example the templates of the
    MyNews application are located in /mmexamples/jsp/mynews/ If you package
    your application be sure to add these files and directories to the
    package.</p></div></div><hr xmlns="" /><p xmlns="">
      This is part of the <a href="http://www.mmbase.org">MMBase</a> documentation.
    </p><p xmlns="">
      For questions and remarks about this documentation mail to: 
      <a href="/cdn-cgi/l/email-protection#3a5e55594f575f544e5b4e5355547a5757585b495f1455485d"><span class="__cf_email__" data-cfemail="4b2f24283e262e253f2a3f2224250b2626292a382e6524392c">[email&#160;protected]</span></a></p><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>MMBase Configuration documentation</title><link href="../style/documentation.css" rel="stylesheet" type="text/css" /><meta content="DocBook XSL Stylesheets V1.72.0" name="generator" /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="icon" /><link xmlns="" type="image/x-icon" href="../style/favicon.ico" rel="shortcut icon" /><meta xmlns="" content="text/html; charset=utf-8" http-equiv="content-type" /></head><body><div xmlns="" class="navigation"><img alt="mmbase logo" src="../style/logo.png" /><h2>MMBase Configuration documentation</h2><p><a href="configuration.html#introduction">Introduction</a></p><p><a href="configuration.html#webxml">Web.xml configuration</a></p><p><a href="configuration.html#nowebxml">Running MMBase without a web.xml</a></p><p><a href="configuration.html#builders">Builders</a></p><p><a href="configuration.html#databases">Databases</a></p><p><a href="configuration.html#logging">Configuring logging</a></p><p><a href="configuration.html#caches">Caches</a></p><p><a href="configuration.html#dtd">DTD's, XSD's and validation</a></p><p><a href="configuration.html#xml.entities">XML Entities</a></p><hr /><p><a href="http://www.mmbase.org">MMBase</a></p><p><a href="../index.html">home</a></p></div><div class="article" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="N10001" />MMBase Configuration documentation</h1></div><div><div class="authorgroup"><strong class="authorgroup">Author: </strong><span class="author"><span class="firstname">Michiel</span> <span class="surname">Meeuwissen</span></span><br /><strong class="authorgroup">Date: </strong>2006-06-24</div></div><div><div class="legalnotice"><a id="N10018" /><p>This software is OSI Certified Open Source Software. OSI Certified
      is a certification mark of the Open Source Initiative.</p><p>The license (Mozilla version 1.0) can be read at the MMBase site.
      See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/license" target="_top">http://www.mmbase.org/license</a></p></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="configuration.html#introduction">1. Introduction</a></span></dt><dt><span class="section"><a href="configuration.html#webxml">2. Web.xml configuration</a></span></dt><dd><dl><dt><span class="section"><a href="configuration.html#contextparameters">2.1. Context parameters</a></span></dt><dt><span class="section"><a href="configuration.html#servlets">2.2. Servlets</a></span></dt><dt><span class="section"><a href="configuration.html#taglibs">2.3. Taglibs</a></span></dt><dt><span class="section"><a href="configuration.html#resources">2.4. Resources</a></span></dt><dt><span class="section"><a href="configuration.html#webxmlexample">2.5. Example</a></span></dt></dl></dd><dt><span class="section"><a href="configuration.html#nowebxml">3. Running MMBase without a web.xml</a></span></dt><dt><span class="section"><a href="configuration.html#builders">4. Builders</a></span></dt><dd><dl><dt><span class="section"><a href="configuration.html#builder_dtd">4.1. builder.dtd , builders as urls,people,images ...</a></span></dt></dl></dd><dt><span class="section"><a href="configuration.html#databases">5. Databases</a></span></dt><dt><span class="section"><a href="configuration.html#logging">6. Configuring logging</a></span></dt><dd><dl><dt><span class="section"><a href="configuration.html#settingup">6.1. Setting up the logging system</a></span></dt><dt><span class="section"><a href="configuration.html#logging_levels">6.2. Logging levels.</a></span></dt><dt><span class="section"><a href="configuration.html#log4j">6.3. Configuring the log4j implementation</a></span></dt><dd><dl><dt><span class="section"><a href="configuration.html#log4j_examples">6.3.1. Examples</a></span></dt><dt><span class="section"><a href="configuration.html#loggers_vs_categories">6.3.2. Loggers/Categories</a></span></dt><dt><span class="section"><a href="configuration.html#appenders">6.3.3. Appenders</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="configuration.html#caches">7. Caches</a></span></dt><dt><span class="appendix"><a href="configuration.html#XML">A. XML</a></span></dt><dd><dl><dt><span class="section"><a href="configuration.html#dtd">1. DTD's, XSD's and validation</a></span></dt><dt><span class="section"><a href="configuration.html#xml.entities">2. XML Entities</a></span></dt></dl></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="introduction" />1. Introduction</h2></div></div></div><p>The MMBase configuration can normally be found in WEB-INF/config.
    Optionally, it is also possible to store this configuration in another
    directory, which then has to be done by use of the web.xml context
    parameter 'mmbase.config'. In this document, this configuration directory
    will be simply referred to as 'config'.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="webxml" />2. Web.xml configuration</h2></div></div></div><p>The base of a web application configuration is always the so-called
    'web.xml'. In a web.xml the following MMBase specific things could be
    found.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="contextparameters" />2.1. Context parameters</h3></div></div></div><p>The parameter 'mmbase.htmlrooturlpath' indicates the context root.
      It must be specified if MMBase does not succeed to determine it
      automatically, otherwise some URLs to some servlets will be generated
      incorrectly. Hopefully this option will be deprecated when the servlet
      2.3 api is supported well (and fully) by all important application
      servers. For Tomcat 4.1 it is not necessary, for Orion 1.6 it is.</p><p>The parameter 'mmbase.config' indicates the MMBase configuration
      directory. If this parameter is missing, the configuration is supposed
      to be in WEB-INF/config (so next to web.xml itself).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="servlets" />2.2. Servlets</h3></div></div></div><p>For MMBase to start up, at least one 'MMBaseServlet' must be
      turned on in your web.xml. The following of those servlets are
      available. <div class="variablelist"><dl><dt><span class="term"><code class="classname">org.mmbase.servlet.MMBaseServlet</code></span></dt><dd><p>MMBaseServlet itself is the most basic MMBaseServlet,
              which can be used to serve the MMBase version number. It has no
              properties to be set. You don't need a servlet-mapping to it (if
              you only want to use it to start up mmbase), though "/version"
              would be nice (and specified as such in the MMBase
              distro).</p><p>If mapped to an URL, then it also recognizes a few
              parameters like 'uptime', 'starttime' and 'server', which, when
              supplied, make the servlet return, besides the mmbase version,
              also some system information.</p></dd><dt><span class="term"><code class="classname">org.mmbase.servlet.ImageServlet</code></span></dt><dd><p>This servlet serves MMBase nodes as images (so also
              icaches). Those nodes must contain an 'handle' field. It has an
              'expire' property, which can be set to specify the 'Expires'
              header (for the node-type 'icaches' this is ignored) in seconds
              after now. A servlet-mapping could be e.g. /images/* or
              /img.db.</p><p>The image servlet also recognizes a 'convert' property,
              which may be `true', in which case it will also accept image
              conversion templates in the URL. This can be switched to true
              for backwards compatibility with `servdb' for which this was the
              way to specify a icache node.</p><p>If you switch this to true, you may also want to switch on
              a 'mmbase.taglib.image.urlconvert' context parameter, which will
              make the image-tag produce these kind of URL's. In 1.8 this does
              not make much sense, because image-transformation would be
              postponed to image serving any way. But it is possible any way
              (from 1.7.4 onwards).</p><p>It is also possible to have the images served by another
              web-application (which you might want for certain load-balancing
              reasons). In that case you don't specify the servlet, but only a
              context parameter 'mmbase.servlet.images.url', containing the
              absolute URL to the image-servlet on the other web-app (so this
              other MMBase must run on the same database!).</p></dd><dt><span class="term"><code class="classname">org.mmbase.servlet.AttachmentServlet</code></span></dt><dd><p>This servlet looks a lot like ImageServlet, but it is
              focused on 'attachments' nodes, which besides a 'handle' also
              store a 'mimetype' field and a 'filename' field. It has the
              'expire' property just like ImageServlet. Map it e.g. to
              /attachments/* or /attachment.db.</p><p>The attachments can, similar to images, also be served
              from a different server. Using the context paramter
              'mmbase.servlet.attachments.url'</p></dd><dt><span class="term"><code class="classname">org.mmbase.servlet.servdb</code></span></dt><dd><p>This servlet is the original one of MMBase 1.5 and before.
              It can do several things and is normally mapped to e.g. /img.db
              and /attachment.db. By the mapping it decides what to do.</p><p>When it is used as an 'imageservlet' it also can accept
              the 'transformation' template to generate a 'icache' node from a
              original image node on the URL. This can be handy, but also
              opens a vulnerability to your site.</p><p>Since servdb is not based on the MMBase bridge, the
              content which it serves is not protected by the security system.
              It will serve any image, attachment etc. disregarding the
              possible read-restrictions on them.</p><p>The implementation of this servlet is nowadays only
              available in mmbase-scan.jar, and it's use is deprecated.</p></dd><dt><span class="term"><code class="classname">org.mmbase.servlet.servscan</code></span></dt><dd><p>If you also have turned on the right MMBase 'modules',
              this servlet will provide the 'SCAN' template language. For new
              users it is advised not to use SCAN, but to use e.g. JSP (the
              JSP servlet and servlet-mapping are normally shipped with and
              installed in your application server). The SCAN servlet servscan
              has to be mapped to '*.shtml'.</p><p>The implementation of this servlet (and of the SCAN
              language) is nowadays only available in mmbase-scan.jar, and
              it's use is deprecated.</p></dd></dl></div></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="taglibs" />2.3. Taglibs</h3></div></div></div><p>If you want to use taglibs in your (jsp) pages - which you
      probably want - then you may have to indicate that as well in web.xml.
      Taglibs that you might want to use are the MMBase taglib, the MMBase
      community taglib, the oscache taglib and the jakarta taglibs. In mosst
      newer application servers it is enough to have the mmbase-taglib-2.jar
      (or other jars) in your WEB-INF/lib directory to have the MMBase taglib
      (or other taglibs) to your disposal. </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="resources" />2.4. Resources</h3></div></div></div><p>Since MMBase 1.6 certain things can (optionally) also be
      configured by the use of references to resources provided by the
      application server. A resource a an instance of a certain type which is
      created and configured and can be referred to by a 'resource
      name'.</p><p>These resources must also be described in web.xml. The actual
      configuration of these resources happens somewhere else and we refer to
      the documentation of your application server.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="webxmlexample" />2.5. Example</h3></div></div></div><p>Here is an example web.xml. Some things are clarified more by use
      of XML comments in it. <div class="example"><a id="examplewebxml" /><p class="title"><b>Example 1. An example web.xml</b></p><div class="example-contents"><a id="web.xml" /><pre class="programlisting">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;

    &lt;!-- comment out if necessary (only in older app-servers)
    &lt;context-param&gt;
        &lt;param-name&gt;mmbase.htmlrooturlpath&lt;/param-name&gt;
        &lt;param-value&gt;/mm/&lt;/param-value&gt;
    &lt;/context-param&gt;
    --&gt;
  &lt;!--
    If you want to serve images from a different server, then you can specify the complete URL to
    the images-servlet in this property.
    The same goes for other 'servlet associations' like 'attachments' and 'downloads'.
    --&gt;
  &lt;!--
  &lt;context-param&gt;
    &lt;param-name&gt;mmbase.servlet.images.url&lt;/param-name&gt;
    &lt;param-value&gt;http://www.myclub.com/mmbase18images/mmbase/images/&lt;/param-value&gt;
  &lt;/context-param&gt;
  --&gt;


    &lt;servlet&gt;
        &lt;servlet-name&gt;version&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.mmbase.servlet.MMBaseServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;images&lt;/servlet-name&gt;
        &lt;display-name&gt;images&lt;/display-name&gt;
        &lt;servlet-class&gt;org.mmbase.servlet.ImageServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;expire&lt;/param-name&gt;&lt;!-- Expire time of original images. Cached images never expire --&gt;
            &lt;param-value&gt;600&lt;/param-value&gt;&lt;!-- 10 minutes --&gt;
         &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;convert&lt;/param-name&gt;&lt;!- Whether to accept convertion templates --&gt;
            &lt;param-value&gt;false&lt;/param-value&gt;&lt;!-- no --&gt;
         &lt;/init-param&gt;
        &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;attachments&lt;/servlet-name&gt;
        &lt;display-name&gt;attachments&lt;/display-name&gt;
        &lt;servlet-class&gt;org.mmbase.servlet.AttachmentServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;expire&lt;/param-name&gt;&lt;!-- Expire time of attachment --&gt;
            &lt;param-value&gt;600&lt;/param-value&gt;&lt;!-- 10 minutes --&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;3&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;version&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/version&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;images&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/images/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;attachments&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/attachments/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;!-- The MMBase taglib
  In Tomcat 5, this section can be left away (it will detect the jar by itself)
  --&gt;
    &lt;taglib&gt;
        &lt;taglib-uri&gt;http://www.mmbase.org/mmbase-taglib-1.0&lt;/taglib-uri&gt;
        &lt;taglib-location&gt;/WEB-INF/lib/mmbase-taglib.jar&lt;/taglib-location&gt;

        &lt;!-- specifying a jar should work according to specs, but does not (yet) in all app-servers
                 if loading the taglib fails, use a separate taglib description file --&gt;
        &lt;!-- &lt;taglib-location&gt;/WEB-INF/mmbase-taglib.tld&lt;/taglib-location&gt; --&gt;
    &lt;/taglib&gt;

    &lt;!-- MMBase community taglib
  In Tomcat 5, this section can be left away (it will detect the jar by itself)
  --&gt;
    &lt;taglib&gt;
        &lt;taglib-uri&gt;http://www.mmbase.org/mmcommunity-taglib-1.0&lt;/taglib-uri&gt;
        &lt;taglib-location&gt;/WEB-INF/lib/mmbase-community.jar&lt;/taglib-location&gt;

        &lt;!-- or use a separate taglib description file  --&gt;
        &lt;!-- &lt;taglib-location&gt;/WEB-INF/mmcommunity-taglib.tld&lt;/taglib-location&gt; --&gt;
    &lt;/taglib&gt;

    &lt;!-- Taglibs not directly related to MMBase --&gt;
    &lt;!--
        The 'Open Symphony' cache tags can e.g. cache your page partially. It uses expire-times or can
        be invalidated programatically.  See http://www.opensymphony.com

    In Tomcat 5 (and using a recent oscache!), this section can be left away (it will detect the jar by itself)
    --&gt;
    &lt;taglib&gt;
        &lt;taglib-uri&gt;oscache&lt;/taglib-uri&gt;
        &lt;taglib-location&gt;/WEB-INF/lib/oscache.jar&lt;/taglib-location&gt;
    &lt;/taglib&gt;

 &lt;resource-ref&gt;
        &lt;description&gt;
            Email module mail resource (JMSendMail). This resource must be
            configured in the application server. See also config/modules/sendmail.xml.
        &lt;/description&gt;
        &lt;res-ref-name&gt;mail/MMBase&lt;/res-ref-name&gt;
        &lt;res-type&gt;javax.mail.Session&lt;/res-type&gt;
        &lt;res-auth&gt;Container&lt;/res-auth&gt;
    &lt;/resource-ref&gt;

    &lt;resource-ref&gt;
        &lt;description&gt;
            Datasource for the MMBase Database. This datasource must be
            configured in the application server. See also config/modules/jdbc.xml
        &lt;/description&gt;
        &lt;res-ref-name&gt;jdbc/MMBase&lt;/res-ref-name&gt;
        &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
        &lt;res-auth&gt;Container&lt;/res-auth&gt;
    &lt;/resource-ref&gt;

&lt;/web-app&gt;

                    </pre></div></div><br class="example-break" /></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="nowebxml" />3. Running MMBase without a web.xml</h2></div></div></div><p>Sometimes it is useful to run (parts of) MMBase outside a servlet
    environment, for example when you are a developer and want to test only a
    certain part without the overhead of starting up a whole application
    server. Another example is when you make a data-importer.</p><p>In such cases the JVM option (-D) mmbase.config might come in handy,
    because most parts of MMBase somehow do need a configuration. It might be
    for example only to configure the logging system.</p><p>In older MMBase versions it was required to use this JVM option even
    when you did run it as a (set of) servlet(s), but this is not any longer
    the case (since MMBase 1.4), and use of '-Dmmbase.config' other then in
    debugging or other 'stand-alone' situations is discouraged.</p><p>In these older versions of MMBase also the 'mmbase.htmlroot' command
    line option was needed. It still is supported (though not by JSP), but I
    can't think of any situation in which it would be needed (besides when
    using a very old MMBase or perhaps a very old application server), and I
    think this option can now be considered fully deprecated. --&gt; perhaps
    in junit tests?</p><p>To complete this description of how to run MMBase outside a servlet
    environment <div class="example"><a id="start_mmbase" /><p class="title"><b>Example 2. Example java code to start MMBase</b></p><div class="example-contents"><a id="examplenowebxml" /><pre class="programlisting">
    try {
         //MMBaseContext.init("HERE YOUR CONFIG_DIR",true); // no need for -Dmmbase.config then.
         MMBaseContext.init();
         MMBase mmb = (MMBase) MMBase.getMMBase();

         // now you have the "MMBase" object
         // All data can be accessed now.

         // with the core:
         MMObjectBuilder images = mmb.getBuilder("episode");
         MMObjectNode node=images.getNewNode("admin");
         node.setValue("title",(Object) "TEST");
         node.insert("admin");

         // or nicer, with the bridge:
         Cloud cloud = LocalContext.getCloudContext().getCloud("mmbase"));
         NodeManager images = cloud.getNodeManager("episode");
         Node node = images.createNode();
         node.setField("title", "TEST");
         node.commit();

     } catch (Exception e) {
         System.out.println("Something went wrong" + e.toString());
     }
     </pre></div></div><br class="example-break" /> You have to make sure that mmbase.jar and your servlet.jar
    are in the classpath. The above code shows you how to access the MMBase
    Data.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="builders" />4. Builders</h2></div></div></div><p>'Builder' is another word for 'object-type'. The builder-definitions
    of your MMBase can be found in config/builders and subdirectories.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="builder_dtd" />4.1. builder.dtd , builders as urls,people,images ...</h3></div></div></div><div class="variablelist"><dl><dt><span class="term">&lt;builder maintainer="mmbase.org" version="0"&gt;</span></dt><dd><p>This file contains all the settings for one builder</p><div class="variablelist"><dl><dt><span class="term">maintainer</span></dt><dd><p>maintainer of the builder defined as a domain</p></dd><dt><span class="term">version</span></dt><dd>version of the builder</dd></dl></div></dd><dt><span class="term">&lt;status&gt;active&lt;/status&gt;</span></dt><dd>state of the builder either active or inactive</dd></dl></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="databases" />5. Databases</h2></div></div></div><p>In the databases subdirectory of the configuration you find the
    XML's describing supported databases. These files are only used by the old
    (pre-1.7) database layer of MMBase. If you intend to use the new Storage
    layer (recommended), you can remove this directory. For configuration of
    the new Storage Layer, see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../backenddevelopers/storage/index.html" target="_top">storage
    documentation</a>.</p><p>Even when you use the old database layer, in an actual installation
    all but one of these files can be removed. It must correspond to the
    'database' property in config/modules/mmbaseroot.xml, if this property is
    present. You can also remove the database property from mmbaseroot.xml (I
    would advice this, because then all database configuration is in
    jdbc.xml), then the 'lookup.xml' file will be used to determine the right
    database configuration XML (so perhaps it is better to leave them) using
    the available driver.</p><p>It is important to make the right driver available, anyhow. This is
    usually done by putting the right jar in WEB-INF/lib. <div class="variablelist"><dl><dt><span class="term"><code class="classname">com.mysql.jdbc.Driver</code> from
          mysql-connector-java-2.0.14-bin.jar</span></dt><dd><p>The mysql driver can be downloaded from <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mysql.com/downloads/api-jdbc.html" target="_top">The mysql
            website</a></p></dd><dt><span class="term"><code class="classname">org.postgresql.Driver</code> from
          pg73jdbc2.jar (make sure to have a version which works with your
          postgresql version / jdk)</span></dt><dd><p>The postgresql driver can be downloaded from <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jdbc.postgresql.org/download.html" target="_top">The postgresql
            website</a></p></dd></dl></div> Support for other databases is also present in MMBase.
    The file 'config/databases/lookup.xml' should give some impression about
    which drives are known to work.</p><p>The file in which is configured which driver MMBase must use is
    config/modules/jdbc.xml. Other information for this driver can also be
    included. Here you can configure the username/password for access to the
    database, the database name itself, the port number on which the database
    is listening etc. <div class="example"><a id="examplejdbc.xml" /><p class="title"><b>Example 3. An example jdbc.xml</b></p><div class="example-contents"><a id="jdbc.xml" /><pre class="programlisting">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE module PUBLIC "-//MMBase/ DTD module config 1.0//EN" "http://www.mmbase.org/dtd/module_1_0.dtd"&gt;
&lt;module maintainer="mmbase.org" version="0"&gt;
    &lt;status&gt;active&lt;/status&gt;
    &lt;classfile&gt;org.mmbase.module.database.JDBC&lt;/classfile&gt;
    &lt;properties&gt;
        &lt;property name="supportclass"&gt;org.mmbase.module.database.DatabaseSupportShim&lt;/property&gt;
        &lt;property name="driver"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
        &lt;property name="url"&gt;jdbc:mysql://$HOST:$PORT/$DBM&lt;/property&gt;
        &lt;property name="user"&gt;mmbase&lt;/property&gt;
        &lt;property name="password"&gt;mypassword&lt;/property&gt;
        &lt;property name="database"&gt;mmbase_db&lt;/property&gt;
        &lt;property name="host"&gt;localhost&lt;/property&gt;
        &lt;property name="port"&gt;3306&lt;/property&gt;
        &lt;property name="connections"&gt;20&lt;/property&gt; &lt;!-- size of connection pool --&gt;
        &lt;property name="queries"&gt;256&lt;/property&gt;    &lt;!-- connections are refreshed after 256 uses --&gt;
        &lt;property name="probetime"&gt;300&lt;/property&gt;  &lt;!-- running connections are checked once every 300 s --&gt;
    &lt;/properties&gt;
&lt;/module&gt;

                    </pre></div></div><br class="example-break" /></p><p>It is also possible to use the 'data-sources' of the application
    server. The jdbc.xml then looks like this: <div class="example"><a id="datasource_jdbc.xml" /><p class="title"><b>Example 4. An example jdbc.xml, using data-source</b></p><div class="example-contents"><a id="datasourcejdbc.xml" /><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE module PUBLIC "-//MMBase/ DTD module config 1.0//EN" "http://www.mmbase.org/dtd/module_1_0.dtd"&gt;
&lt;module maintainer="mmbase.org" version="0"&gt;
    &lt;status&gt;active&lt;/status&gt;
    &lt;classfile&gt;org.mmbase.module.database.Naming&lt;/classfile&gt;
    &lt;properties&gt;
        &lt;property name="context"&gt;java:comp/env&lt;/property&gt;
        &lt;property name="datasource"&gt;jdbc/MMBase&lt;/property&gt;
    &lt;/properties&gt;
&lt;/module&gt;

                    </pre></div></div><br class="example-break" /> So using this the configuration of the database is totally
    left to the application server. <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you plan to use a application server datasource with the new
        storage layer, you can also configure this in mmbaseroot.xml. In that
        case, you do not need the JDBC module, and can set it to inactive. See
        the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../backenddevelopers/storage/index.html" target="_top">storage
        documentation</a> for details.</p></div></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="logging" />6. Configuring logging</h2></div></div></div><p>This section describes how the logging facilities of MMBase can be
    configured. It will focus on the default configuration, which is based on
    log4j.</p><p>Information about concepts of log4j can be found <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://jakarta.apache.org/log4j" target="_top">here. </a></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="settingup" />6.1. Setting up the logging system</h3></div></div></div><p>The logging system is set up with the file config/log/log.xml,
      which is an XML file with two entries: <div class="variablelist"><dl><dt><span class="term">class</span></dt><dd><p>The class which implements the logging. The mmbase.jar
              provides now two classes which can be used for this.
              <div class="variablelist"><dl><dt><span class="term"><code class="classname">org.mmbase.util.logging.SimpleImpl</code></span></dt><dd><p>Provides a very simple implementation, which
                      'logs' on stdout or stderr. So it can not even log to a
                      file by itself.</p></dd><dt><span class="term"><code class="classname">org.mmbase.util.logging.log4j.Log4jImpl</code></span></dt><dd><p>This is the advised and default. This
                      implementation is based on the log4j system, and if this
                      one is chosen, the log4j.jar is required. The version of
                      log4j.jar must be 1.2.</p></dd></dl></div></p></dd><dt><span class="term">configuration</span></dt><dd><p>A string to configure the logging system. For 'SimpleImpl'
              this is: stderr|stdout[,&lt;logging level&gt;]. So you can only
              decide where the logging must appear, and below which level it
              should not log (the same levels as in the log4j implementation).
              For Log4jImpl it is a file name, in which the configuration is.
              This is an XML file according to the 'DOMConfigurator' of log4j.
              The rest of this document will give a short description of how
              this file looks like.</p></dd></dl></div></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="logging_levels" />6.2. Logging levels.</h3></div></div></div><p>The MMBase implementation of log4j has the following logging
      levels (from low to high). <div class="orderedlist"><ol type="1"><li>trace</li><li>debug</li><li>service</li><li>info</li><li>warn</li><li>error</li><li>fatal</li></ol></div></p><p>In the log4j implementation it is per category possible to set the
      'logging level', which means that only above (and on) that level will be
      logged. In 'simple' implementation only one logging level can be set
      (and categories are ignored).</p><p>In the log4j configuration file for log4j versions 1.1 and lower
      levels are called 'priorities'.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="log4j" />6.3. Configuring the log4j implementation</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="log4j_examples" />6.3.1. Examples</h4></div></div></div><p>Everything which is described here will be much quicker clear if
        you have a few examples handy. A few are checked in the MMBase CVS
        with the names 'log4j.xml' (default), 'log4j.example1.xml' (use of two
        appenders), 'log4j.example2.xml' (XMLLayOut), 'log4j.example3.xml'
        (extra appender for important things). A few were provided by the
        log4j project itself too.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="loggers_vs_categories" />6.3.2. Loggers/Categories</h4></div></div></div><p>A category is chain of string separated by dots, which works a
        little like name-spaces. This means that "A.B.C" is in the "A.B"
        category, and "A.B" is in the category "A".</p><p>In MMBase it was chosen that categories fall together with Java
        class / package names. So if you want to set logging level for
        everything related with the security implementation you have to set
        the category "org.mmbase.security". All MMBase classes/packages can be
        found on www.mmbase.org.</p><p>In the MMBase log4j implementation one extra category is
        defined, namely 'STDERR'. Everything which is produced on stderr
        somewhere in the mmbase code will be redirected to this logging
        category with priority (level) 'info'. Normally, this will not be
        much, but it can be handy during debugging of - for example - jsp
        pages.</p><p>'Categories' inherit properties from each other (if nothing is
        overridden, then 'A.B.C' is like 'A.B'), and there is one 'root'
        category, from which all categories inherit.</p><p>In the log4j XML configuration file, categories are present as
        'logger' tags ('category' in older versions). The name attribute of
        the logger tag contains the category, the previously described string,
        which coincides with Java classes/packages.</p><p>A special category is 'root', which describes the basic
        properties of all categories. It is described with the 'root'
        tag.</p><p>The logging 'level' can be set per category/log by a sub tag of
        'logger', named 'level'. The level class was overridden by MMBase so
        the 'class' attribute must be present on every occurrence. The value
        of this can be stored in an XML entity (&amp;mmlevel;). The actual
        value is set by the 'value' attribute.</p><p>The root tag must appear after the logger tags.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="appenders" />6.3.3. Appenders</h4></div></div></div><p>Think of an appender as a 'log file'. You can configure several
        appenders. Here is a typical appender configuration: <div class="example"><a id="appenders_example" /><p class="title"><b>Example 5. Appenders</b></p><div class="example-contents"><pre class="programlisting">
                    
&lt;appender name="logfile" class="org.apache.log4j.FileAppender" &gt;
    &lt;param name="File"   value="&amp;logdir;mmbase.log" /&gt;
    &lt;param name="Append" value="true" /&gt;
    &lt;layout class="org.apache.log4j.PatternLayout"&gt;
        &lt;param name="ConversionPattern" value="%d{ABSOLUTE} %-5p - %m%n" /&gt;
    &lt;/layout&gt;
&lt;/appender&gt;

                        </pre></div></div><br class="example-break" /> Here is described that the appender is a file, and that
        the filename is 'mmbase.log' in the directory described by the entity
        &amp;logdir;. It appends the logging to the end if the files exist
        already. The precise format of one line is described too, and is in
        this case defined by the Java class "org.apache.log4j.PatternLayout".
        The documentation of this class, and of the 'ConversionPattern'
        parameters can be found here. The conversion pattern can have an
        influence on the over all performance, so you have to be careful with
        it.</p><p>Normally the root category will specify to which appender all
        categories will log (The appender-ref tag in the root tag). A category
        can specify an additional appender. If you want to avoid that this
        category also logs to the appender of 'root' you can use the attribute
        'additivity' of the category tag.</p><p>It would e.g. be interesting to log security related issues to a
        separate logfile, but not to the 'main' log file. Then a new appender
        must be defined, with name 'securityfile', and the category entry for
        'org.mmbase.security' could look like this: <div class="example"><a id="category" /><p class="title"><b>Example 6. Category</b></p><div class="example-contents"><pre class="programlisting">
                            
&lt;logger name="org.mmbase.security" additivity="false" &gt;
        &lt;level class="&amp;mmlevel;" value ="info" /&gt;
        &lt;appender-ref ref="securityfile" /&gt;
&lt;/logger&gt;

                        </pre></div></div><br class="example-break" /></p><p>Per 'FileHandler' also the parameter 'Threshold' can be set,
        which makes it possible to set the logging priority for an appender,
        which means that logging events below this threshold are not logged to
        this appender regardless of the setting of the category.</p><p>This describes the functionality of log4j as far as we foresee
        needing it. As one can see in the log4j javadoc there is much more
        functionality available (specialized appenders (for example which are
        rotated), layouts etc).</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="caches" />7. Caches</h2></div></div></div><p>MMBase has several caches, which can be configured by a file
    'caches.xml' which must be in in the MMBase configuration
    directory.</p><p>Since MMBase-1.8 also the strategies which must be used to
    invalidate entries in Query caches can be configured in this file.</p><div class="example"><a id="caches_example" /><p class="title"><b>Example 7. Caches</b></p><div class="example-contents"><pre class="programlisting">

&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE caches PUBLIC "-//MMBase/DTD cache config 1.0//EN" "http://www.mmbase.org/dtd/caches_1_0.dtd"&gt;

&lt;caches&gt;
    &lt;!-- ================================================================================
    Node caches
    ================================================================================  --&gt;

    &lt;!-- simple nodes --&gt;
    &lt;cache name="Nodes"&gt;
        &lt;status&gt;active&lt;/status&gt;
        &lt;size&gt;4096&lt;/size&gt;
    &lt;/cache&gt;
 .....

&lt;/caches&gt;

            </pre></div></div><br class="example-break" /><p>As can be seen in this example, per cache can be configured if it
    should be active or not and how big it should be.</p><p>In caches.xml itself you should see which caches can be configured,
    and also a description about what exactly they actually cache. Defaults
    cache sizes are chosen to be reasonable, deviating from the defaults
    should be done with good reason.</p></div><div class="appendix" lang="en"><h2 class="title" style="clear: both"><a id="XML" />A. XML</h2><p>Some words about XML, XML Entities and so on. Not directly related
    to MMBase.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="dtd" />1. DTD's, XSD's and validation</h3></div></div></div><p>The format of XML's is defined by dtd's. All MMBase specific XML's
      (recognizable by the DOCTTYPE) are validated when parsed (from MMBase
      1.6 onwards). This means that the dtd's for all these XML type must be
      available. They are available in the mmbase.jar, so you normally will
      not have to worry about them. You can store them in config/dtd where
      MMBase will find them first, so you could override the ones in the jar
      (useful during development). It they cannot be found, validation will
      occur with an empty DTD, resulting in lots of errors in your log.</p><p>Since MMBase 1.8 also some XML's are defined by XML Schema
      Definitions. For example config/datatypes.xml and the new version of the
      builder XML's (with support for datatypes). There is no DOCTYPE on such
      XML's but the root element defined a namespace and 'schemaLocation'. The
      schema is resolved in a similar way as DTD's are resolved.</p><p>If you don't want XML's to be validated, then you can place a
      configuration file config/utils/documentreader.xml (the default version
      is in mmbase.jar), and change it. This can be useful to avoid the
      overhead, or avoid the warning which may fill the log if you have a lot
      of legacy XML's (e.g. some people shipped a zillion of non-validating
      editwizard definitions).</p><p>Validation of non MMBase specific xml's, like web.xml and
      'log4j.xml' is left to the applications responsible for them
      (application server and log4j in these cases).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="xml.entities" />2. XML Entities</h3></div></div></div><p>Entities are an XML concept. They work a little like constants. In
      the examples log4j XML configuration files, they are used to store some
      information in a centralized way. (classnames, log directories).
      Entities can be recognized by the &amp;-sign.</p></div></div></div><hr xmlns="" /><p xmlns="">
      This is part of the <a href="http://www.mmbase.org">MMBase</a> documentation.
    </p><p xmlns="">
      For questions and remarks about this documentation mail to: 
      <a href="/cdn-cgi/l/email-protection#c3a7aca0b6aea6adb7a2b7aaacad83aeaea1a2b0a6edacb1a4"><span class="__cf_email__" data-cfemail="3f5b505c4a525a514b5e4b5650517f52525d5e4c5a11504d58">[email&#160;protected]</span></a></p><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>
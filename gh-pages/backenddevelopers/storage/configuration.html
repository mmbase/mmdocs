<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Storage Configuration</title><link href="../../style/documentation.css" rel="stylesheet" type="text/css" /><meta content="DocBook XSL Stylesheets V1.72.0" name="generator" /><meta name="description" content="Configuration document for Storage" /><link xmlns="" type="image/x-icon" href="../../style/favicon.ico" rel="icon" /><link xmlns="" type="image/x-icon" href="../../style/favicon.ico" rel="shortcut icon" /><meta xmlns="" content="text/html; charset=utf-8" http-equiv="content-type" /></head><body><div xmlns="" class="navigation"><img alt="mmbase logo" src="../../style/logo.png" /><h2>Storage Configuration</h2><p><a href="configuration.html#introduction">Introduction</a></p><p><a href="configuration.html#overview">Overview</a></p><p><a href="configuration.html#configuration_mmbaseroot">MMBaseRoot module</a></p><p><a href="configuration.html#configuration_jdbc">JDBC module</a></p><hr /><p><a href="http://www.mmbase.org">MMBase</a></p><p><a href="../../index.html">home</a></p></div><div class="article" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="N10001" />Storage Configuration</h1></div><div><div class="authorgroup"><strong class="authorgroup">Author: </strong><span class="author"><span class="firstname">Pierre</span> <span class="surname">van Rooden</span></span><br /><strong class="authorgroup">Date: </strong>2004-02-05</div></div><div><div class="legalnotice"><a id="N10027" /><p>This software is OSI Certified Open Source Software. OSI Certified
			is a certification mark of the Open Source Initiative.</p><p>The license (Mozilla version 1.0) can be read at the MMBase site.
			See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.mmbase.org/license" target="_top">http://www.mmbase.org/license</a></p></div></div><div /><div><div class="abstract"><p class="title"><b>Abstract</b></p><p>Configuration document for Storage</p></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="configuration.html#introduction">1. Introduction</a></span></dt><dt><span class="section"><a href="configuration.html#overview">2. Overview</a></span></dt><dt><span class="section"><a href="configuration.html#configuration_mmbaseroot">3. MMBaseRoot module</a></span></dt><dt><span class="section"><a href="configuration.html#configuration_jdbc">4. JDBC module</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="introduction" />1. Introduction</h2></div></div></div><p>This document describes how to configure the MMBase Storage Managers. Included are how to select the proper resource for your database, and how to adapt those resources to your own personal needs.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="overview" />2. Overview</h2></div></div></div><p>Configuration in this document is divided in five sections. The first two sections detail how to set up MMbase to use the storage laeyer, and to allow access to the database server. The last three sections detail how you can change behavior of the storage layer, and how to configure it to work with your specific database server or system setup.
		</p><div class="itemizedlist"><p class="title"><b>Sections:</b></p><ul type="disc"><li><p><b><a href="configuration.html#configuration_mmbaseroot" title="3. MMBaseRoot module">MMBaseRoot module (modules/mmbaseroot.xml)</a>. </b>Basic configuration, selecting storagemanager or datasource.</p></li><li><p><b><a href="configuration.html#configuration_jdbc" title="4. JDBC module">JDBC module (modules/jdbc.xml)</a>. </b>Configuration of the MMBase-provided JDBC interface.</p></li><li><p><b>Database resource (Attributes). </b>Attributes affect the behavior of the database by specifying additional information such as the path to store blobs on file</p></li><li><p><b>Database resource (Options). </b>Options affect the behavior of the database by turning features on or off, such as whether to create compound indexes.</p></li><li><p><b>Database resource (Schemes). </b>Schemes define templates for SQL statements (or parts of SQL statements), such as the CREATE TABLE statement.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="configuration_mmbaseroot" />3. MMBaseRoot module</h2></div></div></div><p>The MMBaseroot module can be used to configure what part of the database storage layer is used by MMBase. You can select a database storagemanager factory (the main engine), a JNDI datasource for accessing the server, and a  storage resource file for configuring the storage layer to fit your server.
		</p><p>By default, MMBase uses the database storage layer, and selects a databse resource based on the database Driver available through the JDBC module (see next section). You can change or set the following properties to change this behavior.
		</p><div class="itemizedlist"><p class="title"><b>Properties:</b></p><ul type="disc"><li><p><b><code class="sgmltag-starttag">&lt;&lt;property name="storagemanagerfactory" &gt;&gt;</code>. </b>This property points out a class to use for instantiating the storage manager factory class. This class is the engine that provides access to the storage device (i.e. a database). In MMBase 1.7, you have to provide this property in order to use the new storage layer.</p><div class="itemizedlist"><p class="title"><b>Values:</b></p><ul type="circle"><li><p><b>org.mmbase.storage.implementation.database.DatabaseStorageManagerFactory. </b>Selects the factory that provides generic database access. This is currently the only available factory.</p></li><li><p><b>[empty]. </b>In MMBase 1.7, not specifying the factory prompts the system to use the old 'support' classes. Activate this only if you are upgrading a system and the new storage configuration causes different behavior from the old system (i.e. when your old system uses PostgreSQL, you may want to do this so you can convert BLOB files in the databse to files on disk)</p></li></ul></div></li><li><p><b><code class="sgmltag-starttag">&lt;&lt;property name="datasource" &gt;&gt;</code>. </b>In older systems, connections to the database were created and maintained by the JDBC module. This method is still available with the new storage layer, and can be very useful if you like to run MMBase standalone.</p><p>You can also leave database access and maintenance of such elements as connection pools to the application server.</p><p>This is a more elegant way of accessing the database, but requires some knowledge of how to set up an application server's data-sources (a class that provides a databse connection). Information on setting up datasources can be found in the documentation of your application server. For instance, in Orion, you set up the datasource in a data-sources.xml file in the Orion config directory. Such a file typically looks as follows:</p><pre class="programlisting">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE data-sources PUBLIC "Orion data-sources" "http://www.orionserver.com/dtds/data-sources.dtd"&gt;
&lt;data-sources&gt;
	&lt;data-source
		class="com.evermind.sql.DriverManagerDataSource"
		name="Hsqldb"
		location="jdbc/HsqldbCoreDS"
		xa-location="jdbc/xa/HsqldbXADS"
		ejb-location="jdbc/HsqldbDS"
		connection-driver="org.hsqldb.jdbcDriver"
		username="sa"
		password=""
		url="jdbc:hsqldb:./database/defaultdb"
		inactivity-timeout="30"
	/&gt;
&lt;/data-sources&gt;
				</pre><p>This configures a datasource for a hsqldb database.</p><p>After setting up the datasource, you need to specify a JNDI pointer to it. This pointer is an identifier equal to one of the 'location' identifiers specified for the datasource. We recommend using the 'ejb-location' identifier ('dbc/HsqldbDS' in the example), as that will provide connection pooling, which speeds up the storage layer. If you use this method, you need to turn off the JDBC Module (by setting it's status to inactive).</p></li><li><p><b><code class="sgmltag-starttag">&lt;&lt;property name="datasource-context" &gt;&gt;</code>. </b>Specifies the context for the datasource.</p><p>The default value is "java:comp/env".</p></li><li><p><b><code class="sgmltag-starttag">&lt;&lt;property name="database" &gt;&gt;</code>. </b>MMBase needs some additonal configuration data to deal with the database connection. Most databases have some peculiarities, but by specifying the right parameters you can work around this. You can set up your own resource, or use the set of resources delivered with MMBase.</p><p>MMBase provides a mechanism to automatically determine what configuraton to use, based on information obtained from the datasource. As such, you generally only need to specify what configuration to use if you have your supply own configuration file, or if MMBase, for some reason, fails to correctly determine what database you have.</p><p>To explicitly set the configuration resource to use, you specify a pathname to the resource in the 'database' property.</p><div class="example"><a id="N100B2" /><p class="title"><b>Example 1. </b></p><div class="example-contents"><pre class="programlisting">&lt;property name="database"&gt;/org/mmbase/storage/implementation/database/resources/hsqldb.xml&lt;/property&gt;</pre></div></div><br class="example-break" /><p>The path is a classpath to the resource (the resource needs to be present in the MMBase classpath). If the resource is a .xml file located in the org.mmbase.storage.implementation.database.resources package, you can use shortcut notation as follows :
				</p><div class="example"><a id="N100B9" /><p class="title"><b>Example 2. </b></p><div class="example-contents"><pre class="programlisting">&lt;property name="database"&gt;hsqldb&lt;/property&gt;</pre></div></div><br class="example-break" /><p>The storage will automatically expand the name to its correct resource path.</p><div class="itemizedlist"><p class="title"><b>Available resources:</b></p><ul type="circle"><li><p><b>[empty] (recommended). </b>Causes MMBase to attempt to select the database resource by itself, based on information from the database JDBC Driver. A lookup table exists which contains information on the most common drivers for the supported databases.
              </p></li><li><p><b>mysql. </b>Selects the predefined MySQL database resource</p></li><li><p><b>postgresql. </b>Selects the predefined PostGreSQl database resource</p></li><li><p><b>hsqldb. </b>Selects the predefined HSQLDB database resource</p></li><li><p><b>hypersonic. </b>Selects the predefined Hypersonic database resource</p></li><li><p><b>informix. </b>Selects the predefined Informix database resource</p></li></ul></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="configuration_jdbc" />4. JDBC module</h2></div></div></div><p>The JDBC module provides a connection to a database through the JDBC interface. The module is wrapped by the Storage layer in a datasource (see above) and can thus be used to 'emulate' a datsource when an application server is not available.</p><p>The configuration file can be found under <code class="filename">config/modules/jdbc.xml</code>. By default this modules is active. If you have specified a datasource in the MMBaseRoot module configuration, you should set the JDBC module to inactive or remove the configurationfile alltogether.</p><div class="itemizedlist"><ul type="disc"><li><p><b>url. </b>Defines the jdbc url MMBase will use to connect to your database. You can use a number of patterns similar to variables in the url, which are set by other tags.</p><div class="itemizedlist"><p class="title"><b>Variables available are:</b></p><ul type="circle"><li><p><b>$HOST. </b>set by the <code class="sgmltag-starttag">&lt;&lt;host&gt;&gt;</code> tag</p></li><li><p><b>$PORT. </b>set by the <code class="sgmltag-starttag">&lt;&lt;port&gt;&gt;</code> tag</p></li><li><p><b>$DBM. </b>set by the <code class="sgmltag-starttag">&lt;&lt;dbm&gt;&gt;</code> tag</p></li></ul></div><div class="example"><a id="N1011A" /><p class="title"><b>Example 3. An example url for MySQL:</b></p><div class="example-contents"><pre class="programlisting">
&lt;property name="url"&gt;jdbc:mysql://$HOST:$PORT/$DBM&lt;/property&gt;
					</pre></div></div><br class="example-break" /><div class="example"><a id="N1011F" /><p class="title"><b>Example 4. An example url for HSQLDB:</b></p><div class="example-contents"><pre class="programlisting">
&lt;property name="url"&gt;jdbc:hsqldb:$DBM&lt;/property&gt;
					</pre></div></div><br class="example-break" /></li><li><p><b>user. </b>The name of the user with which to log on to the database.</p></li><li><p><b>password. </b>The password with which to log on to the database.</p></li><li><p><b>host. </b>Specifieds the server host (the machine on which the database runs). If you run MMBase on the same machine as the database, you can set the value to 'localhost' (the default)</p></li><li><p><b>port. </b>The port the database engine is running on. You can find the port in your database manual or ask the database admininstrator. </p><div class="itemizedlist"><p class="title"><b>Default ports for supported databases are:</b></p><ul type="circle"><li><p><b>MySQL. </b>3306</p></li><li><p><b>Postgresql. </b>5432</p></li><li><p><b>Informix. </b>1525</p></li><li><p><b>HSQLDB/Hypersonic. </b>0 (Not Applicable)</p></li></ul></div></li><li><p><b>database. </b>Most database engines allow you to store multiple databases in one engine.
				Specify this name to select the database within the engine.</p></li><li><p><b>driver. </b>Defines the classname for the used jdbc driver. This can be obtained from the documentation from the jdbc driver you use. Note that the class specified affects the default configuration resource MMBase loads unless you specify the mmbaseroot database property.</p><div class="itemizedlist"><p class="title"><b>Possible driver classes:</b></p><ul type="circle"><li><p><b>MySQL. </b>com.mysql.jdbc.Driver   (http://www.mysql.com/)</p></li><li><p><b>Postgresql. </b>org.postgresql.Driver   (http://jdbc.postgresql.org/)</p></li><li><p><b>HSQLDB. </b>org.hsqldb.jdbcDriver   (http://hsqldb.sourceforge.net/)</p></li><li><p><b>Hypersonic. </b>org.hsql.jdbcDriver   (http://hsqldb.sourceforge.net/)</p></li></ul></div></li><li><p><b>connections. </b>MMBase does its own database connection pooling. Pooling means that connections to the database are kept open  over several database queries, to speed up queries by not logging in and closing the connection on every query. The connections property allows you to set the number of connections MMBase keeps open to the database. The default is 10 connections, You cans et this higher, but consult your server documentation to see what the maximum for your database engine is.</p></li><li><p><b>queries. </b>MMBase replaces connections after a certain nr of executed queries, because some databases drivers or  jdbc drivers may have memory leaks or other possible problems. With the queries property you can set the number of queruies that will be run per connection before it gets replaced. The default is 256 queries.</p></li><li><p><b>probetime. </b>Sometimes connections take a long time. Every now and then the database connection pooling has to check/kill queries that take to long. Connections that are running for more then 120 seconds will then be aborted, and the connection will be closed and freed.  The probetime property is the time in seconds between the checks. The default is 30 seconds.</p></li><li><p><b>supportclass. </b>Specify a class to allow for additional actions to take into account when connecting to a database. The only database that currently uses this feature is Informix, which sets lock modes when initializing a connection.</p><div class="itemizedlist"><p class="title"><b>Values:</b></p><ul type="circle"><li><p><b>org.mmbase.module.database.DatabaseSupportShim. </b>Standard database support class</p></li><li><p><b>org.mmbase.module.database.DatabaseSupportInformix. </b>Support class for Informix</p></li></ul></div></li></ul></div><div class="example"><a id="N101A5" /><p class="title"><b>Example 5. An example jdbc.xml</b></p><div class="example-contents"><a id="jdbc.xml" /><pre class="programlisting">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE module PUBLIC "-//MMBase/ DTD module config 1.0//EN" "http://www.mmbase.org/dtd/module_1_0.dtd"&gt;
&lt;module maintainer="mmbase.org" version="0"&gt;
	&lt;status&gt;active&lt;/status&gt;
	&lt;classfile&gt;org.mmbase.module.database.JDBC&lt;/classfile&gt;
	&lt;properties&gt;
		&lt;property name="supportclass"&gt;org.mmbase.module.database.DatabaseSupportShim&lt;/property&gt;
		&lt;property name="driver"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
		&lt;property name="url"&gt;jdbc:mysql://$HOST:$PORT/$DBM&lt;/property&gt;
		&lt;property name="user"&gt;mmbase&lt;/property&gt;
		&lt;property name="password"&gt;mypassword&lt;/property&gt;
		&lt;property name="database"&gt;mmbase_db&lt;/property&gt;
		&lt;property name="host"&gt;localhost&lt;/property&gt;
		&lt;property name="port"&gt;3306&lt;/property&gt;
		&lt;property name="connections"&gt;20&lt;/property&gt; &lt;!-- size of connection pool --&gt;
		&lt;property name="queries"&gt;256&lt;/property&gt;    &lt;!-- connections are refreshed after 256 uses --&gt;
		&lt;property name="probetime"&gt;300&lt;/property&gt;  &lt;!-- running connections are checked once every 300 s --&gt;
	&lt;/properties&gt;
&lt;/module&gt;

			</pre></div></div><br class="example-break" /></div></div><hr xmlns="" /><p xmlns="">
      This is part of the <a href="http://www.mmbase.org">MMBase</a> documentation.
    </p><p xmlns="">
      For questions and remarks about this documentation mail to: 
      <a href="/cdn-cgi/l/email-protection#395d565a4c545c574d584d5056577954545b584a5c17564b5e"><span class="__cf_email__" data-cfemail="c9ada6aabca4aca7bda8bda0a6a789a4a4aba8baace7a6bbae">[email&#160;protected]</span></a></p><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>